{"version":3,"sources":["global.js"],"names":["_defineProperty","obj","key","value","Object","defineProperty","enumerable","configurable","writable","window","GIDA","menu_global","id","opts","GlobalNav","resizeListeners","scrollListeners","scrollableDetectionTargets","detectScrollable","elm","scrollWidth","clientWidth","r","scrollLeft","classList","remove","throttle","fn","isRunning","run","requestAnimationFrame","document","addEventListener","l","passive","rob","ResizeObserver","oes","oe","target","tar","observe","initializeScrollableDetection","constructor","this","_root","getElementById","querySelector","_openItem","_openTime","_scrollTop","_panels","_st","_canceled","_startX","_startY","_isOpenedByHover","_bar","SEL_NAV_BAR","menuItems","querySelectorAll","_panelParent","SEL_NAV_PANEL_PARENT","_alignPanel","contains","autoClose","autoScroll","_suppressClickCloseAfterHover","_scrollViewOffset","_defMenuItem","_child","_onBeforeOpen","Array","prototype","slice","call","children","navigator","maxTouchPoints","add","CLS_TOUCHED","addClickStateEventListener","open","push","doFirst","onScroll","e","stopPropagation","closeAll","mis","initializeAutoScroll","mi","li","parentElement","CLS_CURRENT","CLS_MENU_ANCESTOR","CLS_PAGE_ANCESTOR","ensureInView","left","createElement","right","insertBefore","firstChild","appendChild","addScrollerEventListener","items","it","createEventListenerEnter","createEventListenerDown","createEventListenerTouchStart","createEventListenerMove","createEventListenerCancel","createEventListenerUp","createEventListenerLeave","cancelable","preventDefault","p","cancelTimeout","offset","st","doing","scroll","scrollBy","setTimeout","clearTimeout","openPanel","bcr","getBoundingClientRect","bottom","top","Math","abs","pageYOffset","item","clientX","clientY","_touched","t","Date","getTime","clearStateOpened","setStateActive","isOpenedByHover","CLS_OPENED","itemToPanel","focus","alignPanel","CLS_ACTIVE","dataset","parent","offsetLeft","offsetWidth","panel","innerWidth","style","bcrI","bcrP","bcrPP","wP","wPP"],"mappings":"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","file":"global.min.js","sourcesContent":["/**\n *\n * Gida Menu - Global (JS)\n *\n * @author Takuto Yanagida\n * @version 2021-07-07\n *\n */\n\n\n(function () {\n\n\twindow.GIDA = window['GIDA'] ?? {};\n\n\twindow.GIDA.menu_global = function (id, opts) {\n\t\tnew GlobalNav(id, opts);\n\t};\n\n\n\t// -------------------------------------------------------------------------\n\n\n\t/**\n\t *\n\t * Common Functions (JS)\n\t *\n\t * @author Takuto Yanagida\n\t * @version 2021-06-30\n\t *\n\t */\n\t\n\t\n\tconst resizeListeners = [];\n\tconst scrollListeners = [];\n\t\n\tfunction onResize(fn, doFirst = false) {\n\t\tif (doFirst) fn();\n\t\tresizeListeners.push(throttle(fn));\n\t}\n\t\n\tfunction onScroll(fn, doFirst = false) {\n\t\tif (doFirst) fn();\n\t\tscrollListeners.push(throttle(fn));\n\t}\n\t\n\t\n\t// -----------------------------------------------------------------------------\n\t\n\t\n\tconst scrollableDetectionTargets = [];\n\t\n\tfunction addScrollableDetectionTarget(tar) {\n\t\tscrollableDetectionTargets.push(tar);\n\t}\n\t\n\tfunction initializeScrollableDetection() {\n\t\tconst rob = new ResizeObserver(oes => {\n\t\t\tfor (const oe of oes) detectScrollable(oe.target);\n\t\t});\n\t\tfor (const tar of scrollableDetectionTargets) {\n\t\t\trob.observe(tar);\n\t\t\ttar.addEventListener('scroll', throttle(() => { detectScrollable(tar); }));\n\t\t}\n\t}\n\t\n\tfunction detectScrollable(elm) {\n\t\tif (elm.scrollWidth - elm.clientWidth > 2) {  // for avoiding needless scrolling\n\t\t\tconst r = elm.scrollLeft / (elm.scrollWidth - elm.clientWidth);\n\t\t\telm.classList[r < 0.95 ? 'add' : 'remove']('scrollable-right');\n\t\t\telm.classList[0.05 < r ? 'add' : 'remove']('scrollable-left');\n\t\t} else {\n\t\t\telm.classList.remove('scrollable-right');\n\t\t\telm.classList.remove('scrollable-left');\n\t\t}\n\t}\n\t\n\t\n\t// -----------------------------------------------------------------------------\n\t\n\t\n\tdocument.addEventListener('DOMContentLoaded', () => {\n\t\twindow.addEventListener('resize', () => { for (const l of resizeListeners) l(); }, { passive: true });\n\t\twindow.addEventListener('scroll', () => { for (const l of scrollListeners) l(); }, { passive: true });\n\t\tinitializeScrollableDetection();\n\t});\n\t\n\tfunction throttle(fn) {\n\t\tlet isRunning;\n\t\tfunction run() {\n\t\t\tisRunning = false;\n\t\t\tfn();\n\t\t}\n\t\treturn () => {\n\t\t\tif (isRunning) return;\n\t\t\tisRunning = true;\n\t\t\trequestAnimationFrame(run);\n\t\t};\n\t}\n\t\n\n\n\t// -------------------------------------------------------------------------\n\n\n\tclass GlobalNav {\n\n\t\tstatic SEL_NAV_BAR          = '.gida-menu-global-bar';\n\t\tstatic SEL_NAV_PANEL_PARENT = '.gida-menu-global-panels';\n\n\t\tstatic CLS_CURRENT       = 'current';\n\t\tstatic CLS_MENU_ANCESTOR = 'menu-ancestor';\n\t\tstatic CLS_PAGE_ANCESTOR = 'page-ancestor';\n\n\t\tstatic CLS_TOUCHED = 'touched';\n\t\tstatic CLS_ACTIVE  = 'active';\n\t\tstatic CLS_OPENED  = 'opened';\n\n\t\tconstructor(id, opts) {\n\t\t\tthis._root = id ? document.getElementById(id) : document.querySelector('.gida-menu-global');\n\t\t\tif (!this._root) return;\n\n\t\t\tthis._openItem  = null;\n\t\t\tthis._openTime  = 0;\n\t\t\tthis._scrollTop = 0;\n\t\t\tthis._panels    = [];\n\t\t\tthis._st        = null;\n\n\t\t\tthis._canceled = false;\n\t\t\tthis._startX   = 0;\n\t\t\tthis._startY   = 0;\n\n\t\t\tthis._isOpenedByHover = false;\n\n\t\t\tthis._bar         = this._root.querySelector(GlobalNav.SEL_NAV_BAR);\n\t\t\tconst menuItems   = this._bar.querySelectorAll('button[data-panel]');\n\t\t\tthis._panelParent = this._root.querySelector(GlobalNav.SEL_NAV_PANEL_PARENT);\n\t\t\tthis._alignPanel  = this._root.classList.contains('pulldown');\n\n\t\t\tconst autoClose                    = opts['autoClose']                    ?? true;\n\t\t\tconst autoScroll                   = opts['autoScroll']                   ?? true;\n\t\t\tthis._suppressClickCloseAfterHover = opts['suppressClickCloseAfterHover'] ?? false;\n\t\t\tthis._scrollViewOffset             = opts['scrollViewOffset']             ?? 20;\n\t\t\tthis._defMenuItem                  = opts['defaultMenuItem']              ?? null;\n\t\t\tthis._child                        = opts['childNav']                     ?? null;\n\t\t\tthis._onBeforeOpen                 = opts['onBeforeOpen']                 ?? null;\n\n\t\t\tif (this._panelParent) {\n\t\t\t\tthis._panels = Array.prototype.slice.call(this._panelParent.children);\n\t\t\t}\n\t\t\t// for avoiding hover style\n\t\t\tif (0 < navigator.maxTouchPoints) {\n\t\t\t\tthis._bar.addEventListener('touchstart', () => {\n\t\t\t\t\tthis._bar.classList.add(GlobalNav.CLS_TOUCHED);\n\t\t\t\t\tthis._panelParent.classList.add(GlobalNav.CLS_TOUCHED);\n\t\t\t\t});\n\t\t\t}\n\t\t\tthis.addClickStateEventListener(menuItems);\n\t\t\tif (this._defMenuItem) this.open(this._defMenuItem);\n\n\t\t\taddScrollableDetectionTarget(this._bar);\n\n\t\t\tif (autoClose) {\n\t\t\t\tonScroll(() => { this.onScroll(); });\n\t\t\t\tif (this._panelParent) this._panelParent.addEventListener('click', e => e.stopPropagation());\n\t\t\t\tdocument.addEventListener('click', () => { this.closeAll(); });\n\t\t\t}\n\t\t\tif (autoScroll) {\n\t\t\t\tconst mis = this._bar.querySelectorAll('a, button[data-panel]');\n\t\t\t\tthis.initializeAutoScroll(mis);\n\t\t\t}\n\t\t}\n\n\t\tinitializeAutoScroll(mis) {\n\t\t\tfor (const mi of mis) {\n\t\t\t\tconst li = mi.parentElement;\n\t\t\t\tif (li.classList.contains(GlobalNav.CLS_CURRENT) ||\n\t\t\t\t\tli.classList.contains(GlobalNav.CLS_MENU_ANCESTOR) ||\n\t\t\t\t\tli.classList.contains(GlobalNav.CLS_PAGE_ANCESTOR))\n\t\t\t\t{\n\t\t\t\t\tthis.ensureInView(mi);\n\t\t\t\t}\n\t\t\t}\n\t\t\tconst left  = document.createElement('div');\n\t\t\tconst right = document.createElement('div');\n\t\t\tleft.classList.add('scroll-left');\n\t\t\tright.classList.add('scroll-right');\n\t\t\tthis._bar.insertBefore(left, this._bar.firstChild);\n\t\t\tthis._bar.appendChild(right);\n\n\t\t\tthis.addScrollerEventListener(left, -48);\n\t\t\tthis.addScrollerEventListener(right, 48);\n\t\t}\n\n\t\taddClickStateEventListener(items) {\n\t\t\tfor (const it of items) {\n\t\t\t\tit.addEventListener('click', (e) => { e.stopPropagation(); });  // For preventing auto-close\n\n\t\t\t\tit.addEventListener('pointerenter',  this.createEventListenerEnter(it));\n\t\t\t\tit.addEventListener('pointerdown',   this.createEventListenerDown());\n\t\t\t\tit.addEventListener('touchstart',    this.createEventListenerTouchStart());\n\t\t\t\tit.addEventListener('pointermove',   this.createEventListenerMove());\n\t\t\t\tit.addEventListener('pointercancel', this.createEventListenerCancel());\n\t\t\t\tit.addEventListener('pointerup',     this.createEventListenerUp(it));\n\t\t\t\tit.addEventListener('pointerleave',  this.createEventListenerLeave());\n\n\t\t\t\t// For disabling gray out when touching on iOS\n\t\t\t\tit.addEventListener('touchend', (e) => { if (e.cancelable) e.preventDefault(); });\n\t\t\t}\n\t\t\tfor (const p of this._panels) {\n\t\t\t\tp.addEventListener('mouseenter', () => this.cancelTimeout());\n\t\t\t}\n\t\t}\n\n\t\taddScrollerEventListener(elm, offset) {\n\t\t\tlet st = null;\n\t\t\tlet doing = false;\n\t\t\tconst scroll = throttle(() => {\n\t\t\t\tthis._bar.scrollBy(offset, 0);\n\t\t\t\tif (!doing) return;\n\t\t\t\tst = setTimeout(scroll, 100);\n\t\t\t});\n\t\t\telm.addEventListener('mouseenter', (e) => {\n\t\t\t\te.preventDefault();\n\t\t\t\tdoing = true;\n\t\t\t\tst = setTimeout(scroll, 100);\n\t\t\t});\n\t\t\telm.addEventListener('mouseleave', (e) => {\n\t\t\t\te.preventDefault();\n\t\t\t\tdoing = false;\n\t\t\t\tif (st) clearTimeout(st);\n\t\t\t\tst = null;\n\t\t\t});\n\t\t}\n\n\t\tcancelTimeout() {\n\t\t\tif (this._st) clearTimeout(this._st);\n\t\t\tthis._st = null;\n\t\t}\n\n\n\t\t// ---------------------------------------------------------------------\n\n\n\t\tonScroll() {\n\t\t\tif (this._child && this._child._openItem) return;\n\t\t\tif (this._openItem) {\n\t\t\t\tconst openPanel = this._panelParent.querySelector('.gida-menu-global-panel.active.opened');\n\t\t\t\tif (!openPanel) return;\n\t\t\t\tconst bcr = openPanel.getBoundingClientRect();\n\t\t\t\tif (\n\t\t\t\t\tbcr.bottom < 0 ||  // When not fixed\n\t\t\t\t\t(0 < bcr.top && bcr.bottom < Math.abs(window.pageYOffset - this._scrollTop))  // When fixed\n\t\t\t\t) {\n\t\t\t\t\tthis.closeAll();\n\t\t\t\t\tthis.cancelTimeout();\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\n\n\t\t// ---------------------------------------------------------------------\n\n\n\t\tcreateEventListenerEnter(item) {\n\t\t\treturn () => {\n\t\t\t\tif (item !== this._openItem) {\n\t\t\t\t\tthis.cancelTimeout();\n\t\t\t\t\tthis._st = setTimeout(() => { this.open(item, true); }, this._openItem !== null ? 400 : 200);\n\t\t\t\t}\n\t\t\t};\n\t\t}\n\n\t\tcreateEventListenerDown() {\n\t\t\treturn (e) => {\n\t\t\t\tthis._canceled = false;\n\t\t\t\tthis._startX   = e.clientX;\n\t\t\t\tthis._startY   = e.clientY;\n\t\t\t};\n\t\t}\n\n\t\tcreateEventListenerTouchStart() {\n\t\t\treturn () => {\n\t\t\t\tthis.cancelTimeout();  // For disabling timeout assigned in enter event\n\t\t\t\tthis._touched = true;\n\t\t\t};\n\t\t}\n\n\t\tcreateEventListenerMove() {\n\t\t\treturn (e) => {\n\t\t\t\tif (10 < Math.abs(e.clientX - this._startX) || 10 < Math.abs(e.clientY - this._startY)) {\n\t\t\t\t\tthis._canceled = true;\n\t\t\t\t}\n\t\t\t};\n\t\t}\n\n\t\tcreateEventListenerCancel() {\n\t\t\treturn () => { this._canceled = true; }\n\t\t}\n\n\t\tcreateEventListenerUp(item) {\n\t\t\treturn () => {\n\t\t\t\tthis.cancelTimeout();\n\t\t\t\tif (this._canceled) return;\n\t\t\t\tif (this._touched) {\n\t\t\t\t\tif (item === this._openItem) {\n\t\t\t\t\t\tthis.closeAll();\n\t\t\t\t\t} else {\n\t\t\t\t\t\tthis.open(item);\n\t\t\t\t\t}\n\t\t\t\t\treturn;\n\t\t\t\t}\n\t\t\t\tconst t = new Date().getTime();\n\t\t\t\tif (t - this._openTime < 200) return;\n\t\t\t\tif (item === this._openItem) {\n\t\t\t\t\tif (this._isOpenedByHover) {\n\t\t\t\t\t\tif (this._suppressClickCloseAfterHover) return;\n\t\t\t\t\t\tif (t - this._openTime < 400) return;\n\t\t\t\t\t}\n\t\t\t\t\tthis.closeAll();\n\t\t\t\t} else {\n\t\t\t\t\tthis.open(item);\n\t\t\t\t}\n\t\t\t};\n\t\t}\n\n\t\tcreateEventListenerLeave() {\n\t\t\treturn () => {\n\t\t\t\tthis.cancelTimeout();\n\t\t\t\tif (this._touched) {\n\t\t\t\t\tthis._touched = false;\n\t\t\t\t\treturn;\n\t\t\t\t}\n\t\t\t\tif (this._openItem !== null) {\n\t\t\t\t\tthis._st = setTimeout(() => { this.closeAll(); }, 800);\n\t\t\t\t}\n\t\t\t};\n\t\t}\n\n\n\t\t// ---------------------------------------------------------------------\n\n\n\t\tcloseAll() {\n\t\t\tif (this._defMenuItem) {\n\t\t\t\tthis.open(this._defMenuItem);\n\t\t\t\treturn;\n\t\t\t}\n\t\t\tthis.clearStateOpened();\n\t\t\tthis.setStateActive(null);\n\t\t}\n\n\t\topen(item, isOpenedByHover = false) {\n\t\t\tthis.clearStateOpened();\n\t\t\tthis.setStateActive(item);\n\t\t\tthis.ensureInView(item);\n\n\t\t\titem.parentElement.classList.add(GlobalNav.CLS_OPENED);\n\t\t\tsetTimeout(() => {\n\t\t\t\tconst p = this.itemToPanel(item);\n\t\t\t\tif (p) {\n\t\t\t\t\tp.classList.add(GlobalNav.CLS_OPENED);\n\t\t\t\t\tp.focus();\n\t\t\t\t}\n\t\t\t\tif (this._alignPanel) this.alignPanel(item, p);\n\t\t\t\tif (this._onBeforeOpen) this._onBeforeOpen(item, p);\n\t\t\t}, 0);\n\t\t\tthis._openItem        = item;\n\t\t\tthis._openTime        = new Date().getTime();\n\t\t\tthis._scrollTop       = window.pageYOffset;\n\t\t\tthis._isOpenedByHover = isOpenedByHover;\n\t\t}\n\n\t\tsetStateActive(item) {\n\t\t\tif (item === null) {\n\t\t\t\tfor (const p of this._panels) {\n\t\t\t\t\tp.classList.remove(GlobalNav.CLS_ACTIVE);\n\t\t\t\t}\n\t\t\t} else {\n\t\t\t\tconst tar = item.dataset['panel'] ?? '';\n\t\t\t\tfor (const p of this._panels) {\n\t\t\t\t\tif (p.id === tar) {\n\t\t\t\t\t\tp.classList.add(GlobalNav.CLS_ACTIVE);\n\t\t\t\t\t} else {\n\t\t\t\t\t\tp.classList.remove(GlobalNav.CLS_ACTIVE);\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\n\t\tclearStateOpened() {\n\t\t\tif (this._child) this._child.closeAll();\n\t\t\tif (!this._openItem) return;\n\t\t\tthis._openItem.parentElement.classList.remove(GlobalNav.CLS_OPENED);\n\t\t\tconst item = this._openItem;\n\t\t\tsetTimeout(() => {\n\t\t\t\tif (item === this._openItem) return;\n\t\t\t\tconst p = this.itemToPanel(item);\n\t\t\t\tif (p) p.classList.remove(GlobalNav.CLS_OPENED);\n\t\t\t}, 400);\n\t\t\tthis._openItem = null;\n\t\t}\n\n\t\titemToPanel(item) {\n\t\t\tconst tar = item.dataset['panel'] ?? '';\n\t\t\tif (tar) return document.getElementById(tar);\n\t\t\treturn null;\n\t\t}\n\n\n\t\t// ---------------------------------------------------------------------\n\n\n\t\tensureInView(mi) {\n\t\t\tconst parent = mi.parentElement;\n\t\t\tconst right = parent.offsetLeft + parent.offsetWidth;\n\t\t\tif (this._bar.offsetWidth < right) {\n\t\t\t\tthis._bar.scrollLeft = parent.offsetLeft - this._scrollViewOffset;\n\t\t\t}\n\t\t\tif (parent.offsetLeft < this._bar.scrollLeft) {\n\t\t\t\tthis._bar.scrollLeft = parent.offsetLeft - this._scrollViewOffset;\n\t\t\t}\n\t\t}\n\n\t\talignPanel(item, panel) {\n\t\t\tif (!panel) return;\n\t\t\tconst w = window.innerWidth;\n\t\t\tif (w <= 600) {\n\t\t\t\tpanel.style.left  = '';\n\t\t\t\tpanel.style.right = '';\n\t\t\t\treturn;\n\t\t\t}\n\t\t\tconst bcrI  = item.getBoundingClientRect();\n\t\t\tconst bcrP  = panel.getBoundingClientRect();\n\t\t\tconst bcrPP = this._panelParent.getBoundingClientRect();\n\t\t\tconst wP    = bcrP.right  - bcrP.left;\n\t\t\tconst wPP   = bcrPP.right - bcrPP.left;\n\t\t\tconst l     = bcrI.left   - bcrPP.left;\n\n\t\t\tif (wPP < l + wP + 16) {\n\t\t\t\tpanel.style.left  = 'unset';\n\t\t\t\tpanel.style.right = '0px';\n\t\t\t} else {\n\t\t\t\tpanel.style.left  = l + 'px';\n\t\t\t\tpanel.style.right = 'unset';\n\t\t\t}\n\t\t}\n\n\t}\n\n})();\n"]}