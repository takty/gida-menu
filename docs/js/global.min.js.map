{"version":3,"sources":["global.js"],"names":["_defineProperty","obj","key","value","Object","defineProperty","enumerable","configurable","writable","window","menu_global","id","arguments","length","undefined","opts","GlobalNav","resizeListeners","scrollListeners","scrollableDetectionTargets","detectScrollable","elm","scrollWidth","clientWidth","r","scrollLeft","classList","remove","throttle","fn","isRunning","run","requestAnimationFrame","document","addEventListener","l","passive","rob","ResizeObserver","oes","oe","target","tar","observe","initializeScrollableDetection","constructor","this","_root","getElementById","querySelector","_openItem","_openTime","_scrollTop","_panels","_st","_canceled","_startX","_startY","_isOpenedByHover","_bar","SEL_NAV_BAR","menuItems","querySelectorAll","popupItems","_panelParent","SEL_NAV_PANEL_PARENT","_alignPanel","contains","doAutoClose","doAutoScroll","_doSuppressClickCloseAfterHover","_scrollViewOffset","_defMenuItem","_child","_onBeforeOpen","Array","prototype","slice","call","children","navigator","maxTouchPoints","e","m","pointerType","CLS_TOUCH","items","clsCurrent","clsHover","root","clsHoverAncestor","enter","add","parentElement","leave","it","addHoverStateEventListener","CLS_CURRENT","CLS_HOVER","CLS_HOVER_ANCESTOR","addClickStateEventListener","open","push","onScroll","stopPropagation","closeAll","mis","initializeAutoScroll","closers","SEL_NAV_CLOSER","c","mi","li","CLS_MENU_ANCESTOR","CLS_PAGE_ANCESTOR","ensureInView","left","createElement","right","insertBefore","firstChild","appendChild","addScrollerEventListener","createEventListenerEnter","createEventListenerDown","createEventListenerTouchStart","createEventListenerMove","createEventListenerCancel","createEventListenerUp","createEventListenerLeave","cancelable","preventDefault","p","cancelTimeout","offset","st","doing","scroll","scrollBy","setTimeout","clearTimeout","openPanel","bcr","getBoundingClientRect","bottom","top","Math","abs","pageYOffset","item","clientX","clientY","_touched","t","Date","getTime","_suppressCloseAll","clearStateOpened","setStateActive","isOpenedByHover","dispatchEvent","MouseEvent","CLS_OPENED","itemToPanel","focus","alignPanel","CLS_ACTIVE","dataset","getAttribute","offsetLeft","offsetWidth","panel","innerWidth","style","bcrI","bcrP","bcrPP","wP","wPP"],"mappings":"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","file":"global.min.js","sourcesContent":["/**\n * Gida Menu - Global\n *\n * @author Takuto Yanagida\n * @version 2022-07-07\n */\n\n\n(function () {\n\n\twindow['GIDA'] = window['GIDA'] ?? {};\n\n\twindow['GIDA'].menu_global = function (id = null, opts = {}) {\n\t\tnew GlobalNav(id, opts);\n\t};\n\n\n\t// -------------------------------------------------------------------------\n\n\n\t/**\n\t * Common Functions\n\t *\n\t * @author Takuto Yanagida\n\t * @version 2022-06-01\n\t */\n\t\n\t\n\tconst resizeListeners = [];\n\tconst scrollListeners = [];\n\t\n\tfunction onResize(fn, doFirst = false) {\n\t\tif (doFirst) fn();\n\t\tresizeListeners.push(throttle(fn));\n\t}\n\t\n\tfunction onScroll(fn, doFirst = false) {\n\t\tif (doFirst) fn();\n\t\tscrollListeners.push(throttle(fn));\n\t}\n\t\n\t\n\t// -----------------------------------------------------------------------------\n\t\n\t\n\tconst scrollableDetectionTargets = [];\n\t\n\tfunction addScrollableDetectionTarget(tar) {\n\t\tscrollableDetectionTargets.push(tar);\n\t}\n\t\n\tfunction initializeScrollableDetection() {\n\t\tconst rob = new ResizeObserver(oes => {\n\t\t\tfor (const oe of oes) detectScrollable(oe.target);\n\t\t});\n\t\tfor (const tar of scrollableDetectionTargets) {\n\t\t\trob.observe(tar);\n\t\t\ttar.addEventListener('scroll', throttle(() => { detectScrollable(tar); }));\n\t\t}\n\t}\n\t\n\tfunction detectScrollable(elm) {\n\t\tif (elm.scrollWidth - elm.clientWidth > 2) {  // for avoiding needless scrolling\n\t\t\tconst r = elm.scrollLeft / (elm.scrollWidth - elm.clientWidth);\n\t\t\telm.classList[r < 0.95 ? 'add' : 'remove']('scrollable-right');\n\t\t\telm.classList[0.05 < r ? 'add' : 'remove']('scrollable-left');\n\t\t} else {\n\t\t\telm.classList.remove('scrollable-right');\n\t\t\telm.classList.remove('scrollable-left');\n\t\t}\n\t}\n\t\n\t\n\t// -----------------------------------------------------------------------------\n\t\n\t\n\tfunction addHoverStateEventListener(items, clsCurrent, clsHover, root = null, clsHoverAncestor = null) {\n\t\tconst enter = (e) => {\n\t\t\tif (e.pointerType === 'mouse' && !e.target.classList.contains(clsCurrent)) {\n\t\t\t\te.target.classList.add(clsHover);\n\t\t\t\tif (clsHoverAncestor) {\n\t\t\t\t\tfor (let elm = e.target.parentElement; elm && elm !== root; elm = elm.parentElement) {\n\t\t\t\t\t\tif (elm.classList.contains(clsHover)) {\n\t\t\t\t\t\t\telm.classList.add(clsHoverAncestor);\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t\tconst leave = (e) => {\n\t\t\tif (e.pointerType === 'mouse' && !e.target.classList.contains(clsCurrent)) {\n\t\t\t\te.target.classList.remove(clsHover);\n\t\t\t\tif (clsHoverAncestor) {\n\t\t\t\t\tfor (let elm = e.target.parentElement; elm && elm !== root; elm = elm.parentElement) {\n\t\t\t\t\t\tif (elm.classList.contains(clsHover)) {\n\t\t\t\t\t\t\telm.classList.remove(clsHoverAncestor);\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t\tfor (const it of items) {\n\t\t\tit.addEventListener('pointerenter', enter);\n\t\t\tit.addEventListener('pointerleave', leave);\n\t\t}\n\t}\n\t\n\t\n\t// -----------------------------------------------------------------------------\n\t\n\t\n\tdocument.addEventListener('DOMContentLoaded', () => {\n\t\twindow.addEventListener('resize', () => { for (const l of resizeListeners) l(); }, { passive: true });\n\t\twindow.addEventListener('scroll', () => { for (const l of scrollListeners) l(); }, { passive: true });\n\t\tinitializeScrollableDetection();\n\t});\n\t\n\tfunction throttle(fn) {\n\t\tlet isRunning;\n\t\tfunction run() {\n\t\t\tisRunning = false;\n\t\t\tfn();\n\t\t}\n\t\treturn () => {\n\t\t\tif (isRunning) return;\n\t\t\tisRunning = true;\n\t\t\trequestAnimationFrame(run);\n\t\t};\n\t}\n\t\n\n\n\t// -------------------------------------------------------------------------\n\n\n\tclass GlobalNav {\n\n\t\tstatic SEL_NAV_BAR          = '.gida-menu-global-bar';\n\t\tstatic SEL_NAV_PANEL_PARENT = '.gida-menu-global-panels';\n\t\tstatic SEL_NAV_CLOSER       = '.gida-menu-global-closer';\n\n\t\tstatic CLS_CURRENT       = 'current';\n\t\tstatic CLS_MENU_ANCESTOR = 'menu-ancestor';\n\t\tstatic CLS_PAGE_ANCESTOR = 'page-ancestor';\n\n\t\tstatic CLS_HOVER  = 'hover';\n\t\tstatic CLS_TOUCH  = 'touch';\n\t\tstatic CLS_ACTIVE = 'active';\n\t\tstatic CLS_OPENED = 'opened';\n\n\t\tstatic CLS_HOVER_ANCESTOR  = 'hover-ancestor';\n\n\t\tconstructor(id, opts) {\n\t\t\tthis._root = id ? document.getElementById(id) : document.querySelector('.gida-menu-global');\n\t\t\tif (!this._root) return;\n\n\t\t\tthis._openItem  = null;\n\t\t\tthis._openTime  = 0;\n\t\t\tthis._scrollTop = 0;\n\t\t\tthis._panels    = [];\n\t\t\tthis._st        = null;\n\n\t\t\tthis._canceled = false;\n\t\t\tthis._startX   = 0;\n\t\t\tthis._startY   = 0;\n\n\t\t\tthis._isOpenedByHover = false;\n\n\t\t\tthis._bar         = this._root.querySelector(GlobalNav.SEL_NAV_BAR);\n\t\t\tconst menuItems   = this._root.querySelectorAll('.menu > li');\n\t\t\tconst popupItems  = this._bar.querySelectorAll('button[data-panel]' + /**/', label[for]'/**/);\n\t\t\tthis._panelParent = this._root.querySelector(GlobalNav.SEL_NAV_PANEL_PARENT);\n\t\t\tthis._alignPanel  = this._root.classList.contains('pulldown');\n\n\t\t\tconst doAutoClose                    = opts['doAutoClose']                    ?? true;\n\t\t\tconst doAutoScroll                   = opts['doAutoScroll']                   ?? true;\n\t\t\tthis._doSuppressClickCloseAfterHover = opts['doSuppressClickCloseAfterHover'] ?? false;\n\t\t\tthis._scrollViewOffset               = opts['scrollViewOffset']               ?? 20;\n\t\t\tthis._defMenuItem                    = opts['defaultMenuItem']                ?? null;\n\t\t\tthis._child                          = opts['childNav']                       ?? null;\n\t\t\tthis._onBeforeOpen                   = opts['onBeforeOpen']                   ?? null;\n\n\t\t\tif (this._panelParent) {\n\t\t\t\tthis._panels = Array.prototype.slice.call(this._panelParent.children);\n\t\t\t}\n\t\t\tif (0 < navigator.maxTouchPoints) {\n\t\t\t\tthis._bar.addEventListener('pointerenter', (e) => {\n\t\t\t\t\tconst m = (e.pointerType === 'mouse') ? 'remove' : 'add';\n\t\t\t\t\tthis._bar.classList[m](GlobalNav.CLS_TOUCH);\n\t\t\t\t\tthis._panelParent.classList[m](GlobalNav.CLS_TOUCH);\n\t\t\t\t});\n\t\t\t}\n\t\t\taddHoverStateEventListener(menuItems, GlobalNav.CLS_CURRENT, GlobalNav.CLS_HOVER, this._root, GlobalNav.CLS_HOVER_ANCESTOR);\n\t\t\tthis.addClickStateEventListener(popupItems);\n\t\t\tif (this._defMenuItem) this.open(this._defMenuItem);\n\n\t\t\taddScrollableDetectionTarget(this._bar);\n\n\t\t\tif (doAutoClose) {\n\t\t\t\tonScroll(() => this.onScroll());\n\t\t\t\tif (this._panelParent) this._panelParent.addEventListener('click', e => e.stopPropagation());\n\t\t\t\tdocument.addEventListener('click', () => this.closeAll());\n\t\t\t}\n\t\t\tif (doAutoScroll) {\n\t\t\t\tconst mis = this._bar.querySelectorAll('a, button[data-panel]' + /**/', label[for]'/**/);\n\t\t\t\tthis.initializeAutoScroll(mis);\n\t\t\t}\n\n\t\t\tconst closers = this._root.querySelectorAll(GlobalNav.SEL_NAV_CLOSER);\n\t\t\tfor (const c of closers) {\n\t\t\t\tc.addEventListener('click', () => this.closeAll());\n\t\t\t}\n\t\t}\n\n\t\tinitializeAutoScroll(mis) {\n\t\t\tfor (const mi of mis) {\n\t\t\t\tconst li = mi.parentElement;\n\t\t\t\tif (li.classList.contains(GlobalNav.CLS_CURRENT) ||\n\t\t\t\t\tli.classList.contains(GlobalNav.CLS_MENU_ANCESTOR) ||\n\t\t\t\t\tli.classList.contains(GlobalNav.CLS_PAGE_ANCESTOR))\n\t\t\t\t{\n\t\t\t\t\tthis.ensureInView(mi);\n\t\t\t\t}\n\t\t\t}\n\t\t\tconst left  = document.createElement('div');\n\t\t\tconst right = document.createElement('div');\n\t\t\tleft.classList.add('scroll-left');\n\t\t\tright.classList.add('scroll-right');\n\t\t\tthis._bar.insertBefore(left, this._bar.firstChild);\n\t\t\tthis._bar.appendChild(right);\n\n\t\t\tthis.addScrollerEventListener(left, -48);\n\t\t\tthis.addScrollerEventListener(right, 48);\n\t\t}\n\n\t\taddClickStateEventListener(items) {\n\t\t\tfor (const it of items) {\n\t\t\t\tit.addEventListener('click', (e) => { e.stopPropagation(); });  // For preventing auto-close\n\n\t\t\t\tit.addEventListener('pointerenter',  this.createEventListenerEnter(it));\n\t\t\t\tit.addEventListener('pointerdown',   this.createEventListenerDown());\n\t\t\t\tit.addEventListener('touchstart',    this.createEventListenerTouchStart());\n\t\t\t\tit.addEventListener('pointermove',   this.createEventListenerMove());\n\t\t\t\tit.addEventListener('pointercancel', this.createEventListenerCancel());\n\t\t\t\tit.addEventListener('pointerup',     this.createEventListenerUp(it));\n\t\t\t\tit.addEventListener('pointerleave',  this.createEventListenerLeave());\n\n\t\t\t\t// For disabling gray out when touching on iOS\n\t\t\t\tit.addEventListener('touchend', (e) => { if (e.cancelable) e.preventDefault(); });\n\t\t\t}\n\t\t\tfor (const p of this._panels) {\n\t\t\t\tp.addEventListener('mouseenter', () => this.cancelTimeout());\n\t\t\t}\n\t\t}\n\n\t\taddScrollerEventListener(elm, offset) {\n\t\t\tlet st = null;\n\t\t\tlet doing = false;\n\t\t\tconst scroll = throttle(() => {\n\t\t\t\tthis._bar.scrollBy(offset, 0);\n\t\t\t\tif (!doing) return;\n\t\t\t\tst = setTimeout(scroll, 100);\n\t\t\t});\n\t\t\telm.addEventListener('mouseenter', (e) => {\n\t\t\t\te.preventDefault();\n\t\t\t\tdoing = true;\n\t\t\t\tst = setTimeout(scroll, 100);\n\t\t\t});\n\t\t\telm.addEventListener('mouseleave', (e) => {\n\t\t\t\te.preventDefault();\n\t\t\t\tdoing = false;\n\t\t\t\tif (st) clearTimeout(st);\n\t\t\t\tst = null;\n\t\t\t});\n\t\t}\n\n\t\tcancelTimeout() {\n\t\t\tif (this._st) clearTimeout(this._st);\n\t\t\tthis._st = null;\n\t\t}\n\n\n\t\t// ---------------------------------------------------------------------\n\n\n\t\tonScroll() {\n\t\t\tif (this._child && this._child._openItem) return;\n\t\t\tif (this._openItem) {\n\t\t\t\tconst openPanel = this._panelParent.querySelector('.gida-menu-global-panel.active.opened');\n\t\t\t\tif (!openPanel) return;\n\t\t\t\tconst bcr = openPanel.getBoundingClientRect();\n\t\t\t\tif (\n\t\t\t\t\tbcr.bottom < 0 ||  // When not fixed\n\t\t\t\t\t(0 < bcr.top && bcr.bottom < Math.abs(window.pageYOffset - this._scrollTop))  // When fixed\n\t\t\t\t) {\n\t\t\t\t\tthis.closeAll();\n\t\t\t\t\tthis.cancelTimeout();\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\n\n\t\t// ---------------------------------------------------------------------\n\n\n\t\tcreateEventListenerEnter(item) {\n\t\t\treturn () => {\n\t\t\t\tif (item !== this._openItem) {\n\t\t\t\t\tthis.cancelTimeout();\n\t\t\t\t\tthis._st = setTimeout(() => this.open(item, true), this._openItem !== null ? 400 : 200);\n\t\t\t\t}\n\t\t\t};\n\t\t}\n\n\t\tcreateEventListenerDown() {\n\t\t\treturn (e) => {\n\t\t\t\tthis._canceled = false;\n\t\t\t\tthis._startX   = e.clientX;\n\t\t\t\tthis._startY   = e.clientY;\n\t\t\t};\n\t\t}\n\n\t\tcreateEventListenerTouchStart() {\n\t\t\treturn () => {\n\t\t\t\tthis.cancelTimeout();  // For disabling timeout assigned in enter event\n\t\t\t\tthis._touched = true;\n\t\t\t};\n\t\t}\n\n\t\tcreateEventListenerMove() {\n\t\t\treturn (e) => {\n\t\t\t\tif (10 < Math.abs(e.clientX - this._startX) || 10 < Math.abs(e.clientY - this._startY)) {\n\t\t\t\t\tthis._canceled = true;\n\t\t\t\t}\n\t\t\t};\n\t\t}\n\n\t\tcreateEventListenerCancel() {\n\t\t\treturn () => { this._canceled = true; }\n\t\t}\n\n\t\tcreateEventListenerUp(item) {\n\t\t\treturn () => {\n\t\t\t\tthis.cancelTimeout();\n\t\t\t\tif (this._canceled) return;\n\t\t\t\tif (this._touched) {\n\t\t\t\t\tif (item === this._openItem) {\n\t\t\t\t\t\tthis.closeAll();\n\t\t\t\t\t} else {\n\t\t\t\t\t\tthis.open(item);\n\t\t\t\t\t}\n\t\t\t\t\treturn;\n\t\t\t\t}\n\t\t\t\tconst t = new Date().getTime();\n\t\t\t\tif (t - this._openTime < 200) return;\n\t\t\t\tif (item === this._openItem) {\n\t\t\t\t\tif (this._isOpenedByHover) {\n\t\t\t\t\t\tif (this._doSuppressClickCloseAfterHover) return;\n\t\t\t\t\t\tif (t - this._openTime < 400) return;\n\t\t\t\t\t}\n\t\t\t\t\tthis.closeAll();\n\t\t\t\t} else {\n\t\t\t\t\tthis.open(item);\n\t\t\t\t}\n\t\t\t};\n\t\t}\n\n\t\tcreateEventListenerLeave() {\n\t\t\treturn () => {\n\t\t\t\tthis.cancelTimeout();\n\t\t\t\tif (this._touched) {\n\t\t\t\t\tthis._touched = false;\n\t\t\t\t\treturn;\n\t\t\t\t}\n\t\t\t\tif (this._openItem !== null) {\n\t\t\t\t\tthis._st = setTimeout(() => this.closeAll(), 800);\n\t\t\t\t}\n\t\t\t};\n\t\t}\n\n\n\t\t// ---------------------------------------------------------------------\n\n\n\t\tcloseAll() {\n\t\t\tif (this._suppressCloseAll) return;\n\t\t\tif (this._defMenuItem) {\n\t\t\t\tthis.open(this._defMenuItem);\n\t\t\t\treturn;\n\t\t\t}\n\t\t\tthis.clearStateOpened();\n\t\t\tthis.setStateActive(null);\n\t\t}\n\n\t\topen(item, isOpenedByHover = false) {\n\t\t\tthis._suppressCloseAll = true;\n\t\t\tdocument.dispatchEvent(new MouseEvent('click'));\n\t\t\tthis._suppressCloseAll = false;\n\n\t\t\tthis.clearStateOpened();\n\t\t\tthis.setStateActive(item);\n\t\t\tthis.ensureInView(item);\n\n\t\t\titem.parentElement.classList.add(GlobalNav.CLS_OPENED);\n\t\t\tsetTimeout(() => {\n\t\t\t\tconst p = this.itemToPanel(item);\n\t\t\t\tif (p) {\n\t\t\t\t\tp.classList.add(GlobalNav.CLS_OPENED);\n\t\t\t\t\tp.focus();\n\t\t\t\t}\n\t\t\t\tif (this._alignPanel) this.alignPanel(item, p);\n\t\t\t\tif (this._onBeforeOpen) this._onBeforeOpen(item, p);\n\t\t\t}, 0);\n\t\t\tthis._openItem        = item;\n\t\t\tthis._openTime        = new Date().getTime();\n\t\t\tthis._scrollTop       = window.pageYOffset;\n\t\t\tthis._isOpenedByHover = isOpenedByHover;\n\t\t}\n\n\t\tsetStateActive(item) {\n\t\t\tif (item === null) {\n\t\t\t\tfor (const p of this._panels) {\n\t\t\t\t\tp.classList.remove(GlobalNav.CLS_ACTIVE);\n\t\t\t\t}\n\t\t\t} else {\n\t\t\t\tconst tar = item.dataset['panel'] ?? /**/item.getAttribute('for') ??/**/ '';\n\t\t\t\tfor (const p of this._panels) {\n\t\t\t\t\tif (p.id === tar) {\n\t\t\t\t\t\tp.classList.add(GlobalNav.CLS_ACTIVE);\n\t\t\t\t\t} else {\n\t\t\t\t\t\tp.classList.remove(GlobalNav.CLS_ACTIVE);\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\n\t\tclearStateOpened() {\n\t\t\tif (this._child) this._child.closeAll();\n\t\t\tif (!this._openItem) return;\n\t\t\tthis._openItem.parentElement.classList.remove(GlobalNav.CLS_OPENED);\n\t\t\tconst item = this._openItem;\n\t\t\tsetTimeout(() => {\n\t\t\t\tif (item === this._openItem) return;\n\t\t\t\tconst p = this.itemToPanel(item);\n\t\t\t\tif (p) p.classList.remove(GlobalNav.CLS_OPENED);\n\t\t\t}, 400);\n\t\t\tthis._openItem = null;\n\t\t}\n\n\t\titemToPanel(item) {\n\t\t\tconst tar = item.dataset['panel'] ?? /**/item.getAttribute('for') ??/**/ '';\n\t\t\tif (tar) return document.getElementById(tar);\n\t\t\treturn null;\n\t\t}\n\n\n\t\t// ---------------------------------------------------------------------\n\n\n\t\tensureInView(mi) {\n\t\t\tconst l = mi.parentElement.offsetLeft;\n\t\t\tconst r = l + mi.parentElement.offsetWidth;\n\t\t\tif (this._bar.scrollLeft + this._bar.offsetWidth < r) {\n\t\t\t\tthis._bar.scrollLeft = r - this._bar.offsetWidth + this._scrollViewOffset;\n\t\t\t}\n\t\t\tif (l < this._bar.scrollLeft) {\n\t\t\t\tthis._bar.scrollLeft = l - this._scrollViewOffset;\n\t\t\t}\n\t\t}\n\n\t\talignPanel(item, panel) {\n\t\t\tif (!panel) return;\n\t\t\tconst w = window.innerWidth;\n\t\t\tif (w <= 600) {\n\t\t\t\tpanel.style.left  = '';\n\t\t\t\tpanel.style.right = '';\n\t\t\t\treturn;\n\t\t\t}\n\t\t\tconst bcrI  = item.getBoundingClientRect();\n\t\t\tconst bcrP  = panel.getBoundingClientRect();\n\t\t\tconst bcrPP = this._panelParent.getBoundingClientRect();\n\t\t\tconst wP    = bcrP.right  - bcrP.left;\n\t\t\tconst wPP   = bcrPP.right - bcrPP.left;\n\t\t\tconst l     = bcrI.left   - bcrPP.left;\n\n\t\t\tif (wPP < l + wP + 16) {\n\t\t\t\tpanel.style.left  = 'unset';\n\t\t\t\tpanel.style.right = '0px';\n\t\t\t} else {\n\t\t\t\tpanel.style.left  = l + 'px';\n\t\t\t\tpanel.style.right = 'unset';\n\t\t\t}\n\t\t}\n\n\t}\n\n})();\n"]}