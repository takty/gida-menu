"use strict";!function(){window.GIDA=window.GIDA??{},window.GIDA.menu_global=function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};new l(e,t)};const e=[],t=[];const s=[];function i(e){if(e.scrollWidth-e.clientWidth>2){const t=e.scrollLeft/(e.scrollWidth-e.clientWidth);e.classList[t<.95?"add":"remove"]("scrollable-right"),e.classList[.05<t?"add":"remove"]("scrollable-left")}else e.classList.remove("scrollable-right"),e.classList.remove("scrollable-left")}function n(e){let t;function s(){t=!1,e()}return()=>{t||(t=!0,requestAnimationFrame(s))}}function o(e,t){let s=null,i=!1,[n,o,l]=[0,0,0];const r=()=>{i=!1,t()};e.addEventListener("pointerenter",(()=>{i=!0})),e.addEventListener("pointermove",(e=>{i&&.1<(e=>{const[t,s,i]=[e.clientX,e.clientY,e.timeStamp],r=((t-n)*(t-n)+(s-o)*(s-o))/(i-l);return[n,o,l]=[t,s,i],r})(e)&&(clearTimeout(s),s=setTimeout(r,50))})),e.addEventListener("pointerleave",(()=>{clearTimeout(s),i=!1}))}document.addEventListener("DOMContentLoaded",(()=>{window.addEventListener("resize",(()=>{for(const t of e)t()}),{passive:!0}),window.addEventListener("scroll",(()=>{for(const e of t)e()}),{passive:!0}),function(){const e=new ResizeObserver((e=>{for(const t of e)i(t.target)}));for(const t of s)e.observe(t),t.addEventListener("scroll",n((()=>{i(t)})))}()}));class l{static SEL_NAV_BAR=".gida-menu-global-bar";static SEL_NAV_PANEL_PARENT=".gida-menu-global-panels";static SEL_NAV_CLOSER=".gida-menu-global-closer";static CLS_PULLDOWN="pulldown";static CLS_UPWARD="upward";static CLS_OVERFLOW_SCROLL="overflow-scroll";static CLS_CURRENT="current";static CLS_MENU_ANCESTOR="menu-ancestor";static CLS_PAGE_ANCESTOR="page-ancestor";static CLS_HOVER="hover";static CLS_TOUCH="touch";static CLS_ACTIVE="active";static CLS_OPENED="opened";static CLS_HOVER_ANCESTOR="hover-ancestor";constructor(e,i){if(this._root=e?document.getElementById(e):document.querySelector(".gida-menu-global"),!this._root)return;this._openItem=null,this._openTime=0,this._scrollTop=0,this._panels=[],this._st=null,this._canceled=!1,this._startX=0,this._startY=0,this._isOpenedByHover=!1,this._bar=this._root.querySelector(l.SEL_NAV_BAR);const o=this._root.querySelectorAll(".menu > li"),r=this._bar.querySelectorAll("button[data-panel], label[for]");this._panelParent=this._root.querySelector(l.SEL_NAV_PANEL_PARENT),this._isPulldown=this._root.classList.contains(l.CLS_PULLDOWN),this._isUpward=this._root.classList.contains(l.CLS_UPWARD),this._isOverflowScroll=this._root.classList.contains(l.CLS_OVERFLOW_SCROLL);const a=i.autoClose??!0,c=i.autoScroll??!0;var h;if(this._scrollViewOffset=i.scrollViewOffset??20,this._defMenuItem=i.defaultMenuItem??null,this._child=i.childNav??null,this._onBeforeOpen=i.onBeforeOpen??null,this._doOpenOnHover=i.doOpenOnHover??!0,this._doSetPanelWidth=i.doSetPanelWidth??!1,this._doSuppressCloseAfterHover=i.doSuppressCloseAfterHover??!1,this._panelParent&&(this._panels=Array.prototype.slice.call(this._panelParent.children)),0<navigator.maxTouchPoints&&this._bar.addEventListener("pointerenter",(e=>{const t="mouse"===e.pointerType?"remove":"add";this._bar.classList[t](l.CLS_TOUCH),this._panelParent.classList[t](l.CLS_TOUCH)})),function(e,t,s){let i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null,n=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null;const o=e=>{if("mouse"===e.pointerType&&!e.target.classList.contains(t)&&(e.target.classList.add(s),n))for(let t=e.target.parentElement;t&&t!==i;t=t.parentElement)t.classList.contains(s)&&t.classList.add(n)},l=e=>{if("mouse"===e.pointerType&&!e.target.classList.contains(t)&&(e.target.classList.remove(s),n))for(let t=e.target.parentElement;t&&t!==i;t=t.parentElement)t.classList.contains(s)&&t.classList.remove(n)};for(const t of e)t.addEventListener("pointerenter",o),t.addEventListener("pointerleave",l)}(o,l.CLS_CURRENT,l.CLS_HOVER,this._root,l.CLS_HOVER_ANCESTOR),this.addClickStateEventListener(r),this._defMenuItem&&this.open(this._defMenuItem),h=this._bar,s.push(h),a&&(!function(e){let s=arguments.length>1&&void 0!==arguments[1]&&arguments[1];s&&e(),t.push(n(e))}((()=>this.onScroll())),this._panelParent&&this._panelParent.addEventListener("click",(e=>e.stopPropagation())),document.addEventListener("click",(()=>this.closeAll()))),c){const e=this._bar.querySelectorAll("a, button[data-panel], label[for]");this.initializeAutoScroll(e)}this.initializeScroller();const d=this._root.querySelectorAll(l.SEL_NAV_CLOSER);for(const e of d)e.addEventListener("click",(()=>this.closeAll()))}initializeAutoScroll(e){for(const t of e){const e=t.parentElement;(e.classList.contains(l.CLS_CURRENT)||e.classList.contains(l.CLS_MENU_ANCESTOR)||e.classList.contains(l.CLS_PAGE_ANCESTOR))&&this.ensureInView(t)}}initializeScroller(){const e=document.createElement("div"),t=document.createElement("div");e.classList.add("scroll-left"),t.classList.add("scroll-right"),this._bar.insertBefore(e,this._bar.firstChild),this._bar.appendChild(t),this.addScrollerEventListener(e,-48),this.addScrollerEventListener(t,48)}addClickStateEventListener(e){for(const t of e)t.addEventListener("click",(e=>{e.stopPropagation()})),this._doOpenOnHover&&o(t,this.createEventListenerEnter(t)),t.addEventListener("pointerdown",this.createEventListenerDown()),t.addEventListener("touchstart",this.createEventListenerTouchStart()),t.addEventListener("pointermove",this.createEventListenerMove()),t.addEventListener("pointercancel",this.createEventListenerCancel()),t.addEventListener("pointerup",this.createEventListenerUp(t)),t.addEventListener("pointerleave",this.createEventListenerLeave()),t.addEventListener("touchend",(e=>{e.cancelable&&e.preventDefault()}));for(const e of this._panels)e.addEventListener("mouseenter",(()=>this.cancelTimeout()))}addScrollerEventListener(e,t){let s=null,i=!1;const o=n((()=>{this._bar.scrollBy(t,0),i&&(s=setTimeout(o,100))}));e.addEventListener("mouseenter",(e=>{e.preventDefault(),i=!0,s=setTimeout(o,100)})),e.addEventListener("mouseleave",(e=>{e.preventDefault(),i=!1,s&&clearTimeout(s),s=null}))}cancelTimeout(){this._st&&clearTimeout(this._st),this._st=null}onScroll(){if((!this._child||!this._child._openItem)&&this._openItem){const e=this._panelParent.querySelector(".gida-menu-global-panel.active.opened");if(!e)return;const t=e.getBoundingClientRect();(t.bottom<0||0<t.top&&t.bottom<Math.abs(window.pageYOffset-this._scrollTop))&&(this.closeAll(),this.cancelTimeout())}}createEventListenerEnter(e){return()=>{e!==this._openItem&&(this.cancelTimeout(),this._st=setTimeout((()=>this.open(e,!0)),100))}}createEventListenerDown(){return e=>{this._canceled=!1,this._startX=e.clientX,this._startY=e.clientY}}createEventListenerTouchStart(){return()=>{this.cancelTimeout(),this._touched=!0}}createEventListenerMove(){return e=>{(10<Math.abs(e.clientX-this._startX)||10<Math.abs(e.clientY-this._startY))&&(this._canceled=!0)}}createEventListenerCancel(){return()=>{this._canceled=!0}}createEventListenerUp(e){return()=>{if(this.cancelTimeout(),this._canceled)return;if(this._touched)return void(e===this._openItem?this.closeAll():this.open(e));const t=(new Date).getTime();if(!(t-this._openTime<200))if(e===this._openItem){if(this._isOpenedByHover){if(this._doSuppressCloseAfterHover)return;if(t-this._openTime<400)return}this.closeAll()}else this.open(e)}}createEventListenerLeave(){return()=>{this.cancelTimeout(),this._touched?this._touched=!1:null!==this._openItem&&(this._st=setTimeout((()=>this.closeAll()),800))}}closeAll(){this._suppressCloseAll||(this._defMenuItem?this.open(this._defMenuItem):(this.clearStateOpened(),this.setStateActive(null)))}open(e){let t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];this._suppressCloseAll=!0,document.dispatchEvent(new MouseEvent("click")),this._suppressCloseAll=!1,this.clearStateOpened(),this.setStateActive(e),this.ensureInView(e),e.parentElement.classList.add(l.CLS_OPENED),setTimeout((()=>{const t=this.itemToPanel(e);t&&(t.classList.add(l.CLS_OPENED),t.focus()),this._isPulldown&&this.alignPanel(e,t),this._isOverflowScroll&&this.assignVisibleHeight(e,t),this._onBeforeOpen&&this._onBeforeOpen(e,t)}),0),this._openItem=e,this._openTime=(new Date).getTime(),this._scrollTop=window.pageYOffset,this._isOpenedByHover=t}setStateActive(e){if(null===e)for(const e of this._panels)e.classList.remove(l.CLS_ACTIVE);else{const t=e.dataset.panel??e.getAttribute("for")??"";for(const e of this._panels)e.id===t?e.classList.add(l.CLS_ACTIVE):e.classList.remove(l.CLS_ACTIVE)}}clearStateOpened(){if(this._child&&this._child.closeAll(),!this._openItem)return;this._openItem.parentElement.classList.remove(l.CLS_OPENED);const e=this._openItem;setTimeout((()=>{if(e===this._openItem)return;const t=this.itemToPanel(e);t&&t.classList.remove(l.CLS_OPENED)}),400),this._openItem=null}itemToPanel(e){const t=e.dataset.panel??e.getAttribute("for")??"";return t?document.getElementById(t):null}ensureInView(e){const t=e.parentElement.offsetLeft,s=t+e.parentElement.offsetWidth;this._bar.scrollLeft+this._bar.offsetWidth<s&&(this._bar.scrollLeft=s-this._bar.offsetWidth+this._scrollViewOffset),t<this._bar.scrollLeft&&(this._bar.scrollLeft=t-this._scrollViewOffset)}alignPanel(e,t){if(!t)return;if(window.innerWidth<=600)return t.style.left="",t.style.right="",void(this._doSetPanelWidth&&(t.style.minWidth=""));const s=e.getBoundingClientRect(),i=t.getBoundingClientRect(),n=this._panelParent.getBoundingClientRect(),o=i.right-i.left,l=n.right-n.left,r=s.left-n.left,a=l<r+o+16;t.style.left=a?"unset":`${r}px`,t.style.right=a?"0px":"unset",this._doSetPanelWidth&&(t.style.minWidth=s.right-s.left+"px")}assignVisibleHeight(e,t){if(!t)return;const s=window.innerHeight;let i=parseInt(document.documentElement.style.scrollPaddingTop,10);i=isNaN(i)?0:i,t.style.setProperty("--visible-height",null);const n=e.getBoundingClientRect(),o=t.getBoundingClientRect();s-n.height-i<o.height&&t.style.setProperty("--visible-height",s-n.height-i+"px")}}}();
//# sourceMappingURL=global.min.js.map