"use strict";!function(){window.GIDA=window.GIDA??{},window.GIDA.menu_global=function(){new o(arguments.length>0&&void 0!==arguments[0]?arguments[0]:null,arguments.length>1&&void 0!==arguments[1]?arguments[1]:{})};const t=[];const e=[];function s(){const t=new ResizeObserver((t=>{for(const e of t)i(e.target)}));for(const s of e)t.observe(s),s.addEventListener("scroll",n((()=>{i(s)})));e.length=0}function i(t){if(t.scrollWidth-t.clientWidth>2){const e=t.scrollLeft/(t.scrollWidth-t.clientWidth);t.classList[e<.95?"add":"remove"]("scrollable-right"),t.classList[.05<e?"add":"remove"]("scrollable-left")}else t.classList.remove("scrollable-right"),t.classList.remove("scrollable-left")}function n(t){let e;function s(){e=!1,t()}return()=>{e||(e=!0,requestAnimationFrame(s))}}function l(t,e){let s=null,i=!1,[n,l,o]=[0,0,0];const r=()=>{i=!1,e()};t.addEventListener("pointerenter",(()=>{i=!0})),t.addEventListener("pointermove",(t=>{i&&.1<(t=>{const[e,s,i]=[t.clientX,t.clientY,t.timeStamp],r=((e-n)*(e-n)+(s-l)*(s-l))/(i-o);return[n,l,o]=[e,s,i],r})(t)&&(clearTimeout(s),s=setTimeout(r,50))})),t.addEventListener("pointerleave",(()=>{clearTimeout(s),i=!1}))}document.addEventListener("DOMContentLoaded",(()=>{window.addEventListener("scroll",(()=>{for(const e of t)e()}),{passive:!0}),s(),window.addEventListener("load",s)}));class o{static SEL_NAV_BAR=".gida-menu-global-bar";static SEL_NAV_PANEL_PARENT=".gida-menu-global-panels";static SEL_NAV_CLOSER=".gida-menu-global-closer";static CLS_PULLDOWN="pulldown";static CLS_UPWARD="upward";static CLS_OVERFLOW_SCROLL="overflow-scroll";static CLS_CURRENT="current";static CLS_MENU_ANCESTOR="menu-ancestor";static CLS_PAGE_ANCESTOR="page-ancestor";static CLS_HOVER="hover";static CLS_TOUCH="touch";static CLS_ACTIVE="active";static CLS_OPENED="opened";static CLS_HOVER_ANCESTOR="hover-ancestor";constructor(s,i){if(this._root=s?document.getElementById(s):document.querySelector(".gida-menu-global"),!this._root)return;this._openItem=null,this._openTime=0,this._scrollTop=0,this._panels=[],this._st=null,this._canceled=!1,this._startX=0,this._startY=0,this._isOpenedByHover=!1,this._bar=this._root.querySelector(o.SEL_NAV_BAR);const l=this._root.querySelectorAll(".menu > li"),r=this._bar.querySelectorAll("button[data-panel], label[for]");this._panelParent=this._root.querySelector(o.SEL_NAV_PANEL_PARENT),this._isPulldown=this._root.classList.contains(o.CLS_PULLDOWN),this._isUpward=this._root.classList.contains(o.CLS_UPWARD),this._isOverflowScroll=this._root.classList.contains(o.CLS_OVERFLOW_SCROLL);const a=i.autoClose??!0,c=i.autoScroll??!0;var h;if(this._scrollViewOffset=i.scrollViewOffset??20,this._defMenuItem=i.defaultMenuItem??null,this._child=i.childNav??null,this._onBeforeOpen=i.onBeforeOpen??null,this._doOpenOnHover=i.doOpenOnHover??!0,this._doSetPanelWidth=i.doSetPanelWidth??!1,this._doSuppressCloseAfterHover=i.doSuppressCloseAfterHover??!1,this._panelParent&&(this._panels=Array.prototype.slice.call(this._panelParent.children)),0<navigator.maxTouchPoints&&this._bar.addEventListener("pointerenter",(t=>{const e="mouse"===t.pointerType?"remove":"add";this._bar.classList[e](o.CLS_TOUCH),this._panelParent.classList[e](o.CLS_TOUCH)})),function(t,e,s){let i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null,n=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null;const l=t=>{if("mouse"===t.pointerType&&!t.target.classList.contains(e)&&(t.target.classList.add(s),n))for(let e=t.target.parentElement;e&&e!==i;e=e.parentElement)e.classList.contains(s)&&e.classList.add(n)},o=t=>{if("mouse"===t.pointerType&&!t.target.classList.contains(e)&&(t.target.classList.remove(s),n))for(let e=t.target.parentElement;e&&e!==i;e=e.parentElement)e.classList.contains(s)&&e.classList.remove(n)};for(const e of t)e.addEventListener("pointerenter",l),e.addEventListener("pointerleave",o)}(l,o.CLS_CURRENT,o.CLS_HOVER,this._root,o.CLS_HOVER_ANCESTOR),this.addClickStateEventListener(r),this._defMenuItem&&this.open(this._defMenuItem),h=this._bar,e.push(h),a&&(!function(e){arguments.length>1&&void 0!==arguments[1]&&arguments[1]&&e(),t.push(n(e))}((()=>this.onScroll())),this._panelParent&&this._panelParent.addEventListener("click",(t=>t.stopPropagation())),document.addEventListener("click",(()=>this.closeAll()))),c){const t=this._bar.querySelectorAll("a, button[data-panel], label[for]");this.initializeAutoScroll(t)}this.initializeScroller();const d=this._root.querySelectorAll(o.SEL_NAV_CLOSER);for(const t of d)t.addEventListener("click",(()=>this.closeAll()))}initializeAutoScroll(t){for(const e of t){const t=e.parentElement;(t.classList.contains(o.CLS_CURRENT)||t.classList.contains(o.CLS_MENU_ANCESTOR)||t.classList.contains(o.CLS_PAGE_ANCESTOR))&&this.ensureInView(e)}}initializeScroller(){const t=document.createElement("div"),e=document.createElement("div");t.classList.add("scroll-left"),e.classList.add("scroll-right"),this._bar.insertBefore(t,this._bar.firstChild),this._bar.appendChild(e),this.addScrollerEventListener(t,-48),this.addScrollerEventListener(e,48)}addClickStateEventListener(t){for(const e of t)e.addEventListener("click",(t=>{t.stopPropagation()})),this._doOpenOnHover&&l(e,this.createEventListenerEnter(e)),e.addEventListener("pointerdown",this.createEventListenerDown()),e.addEventListener("touchstart",this.createEventListenerTouchStart()),e.addEventListener("pointermove",this.createEventListenerMove()),e.addEventListener("pointercancel",this.createEventListenerCancel()),e.addEventListener("pointerup",this.createEventListenerUp(e)),e.addEventListener("pointerleave",this.createEventListenerLeave()),e.addEventListener("touchend",(t=>{t.cancelable&&t.preventDefault()}));for(const t of this._panels)t.addEventListener("mouseenter",(()=>this.cancelTimeout()))}addScrollerEventListener(t,e){let s=null,i=!1;const l=n((()=>{this._bar.scrollBy(e,0),i&&(s=setTimeout(l,100))}));t.addEventListener("mouseenter",(t=>{t.preventDefault(),i=!0,s=setTimeout(l,100)})),t.addEventListener("mouseleave",(t=>{t.preventDefault(),i=!1,s&&clearTimeout(s),s=null}))}cancelTimeout(){this._st&&clearTimeout(this._st),this._st=null}onScroll(){if((!this._child||!this._child._openItem)&&this._openItem){const t=this._panelParent.querySelector(".gida-menu-global-panel.active.opened");if(!t)return;const e=t.getBoundingClientRect();(e.bottom<0||0<e.top&&e.bottom<Math.abs(window.scrollY-this._scrollTop))&&(this.closeAll(),this.cancelTimeout())}}createEventListenerEnter(t){return()=>{t!==this._openItem&&(this.cancelTimeout(),this._st=setTimeout((()=>this.open(t,!0)),100))}}createEventListenerDown(){return t=>{this._canceled=!1,this._startX=t.clientX,this._startY=t.clientY}}createEventListenerTouchStart(){return()=>{this.cancelTimeout(),this._touched=!0}}createEventListenerMove(){return t=>{(10<Math.abs(t.clientX-this._startX)||10<Math.abs(t.clientY-this._startY))&&(this._canceled=!0)}}createEventListenerCancel(){return()=>{this._canceled=!0}}createEventListenerUp(t){return()=>{if(this.cancelTimeout(),this._canceled)return;if(this._touched)return void(t===this._openItem?this.closeAll():this.open(t));const e=(new Date).getTime();if(!(e-this._openTime<200))if(t===this._openItem){if(this._isOpenedByHover){if(this._doSuppressCloseAfterHover)return;if(e-this._openTime<400)return}this.closeAll()}else this.open(t)}}createEventListenerLeave(){return()=>{this.cancelTimeout(),this._touched?this._touched=!1:null!==this._openItem&&(this._st=setTimeout((()=>this.closeAll()),800))}}closeAll(){this._suppressCloseAll||(this._defMenuItem?this.open(this._defMenuItem):(this.clearStateOpened(),this.setStateActive(null)))}open(t){let e=arguments.length>1&&void 0!==arguments[1]&&arguments[1];this._suppressCloseAll=!0,document.dispatchEvent(new MouseEvent("click")),this._suppressCloseAll=!1,this.clearStateOpened(),this.setStateActive(t),this.ensureInView(t),t.parentElement.classList.add(o.CLS_OPENED),setTimeout((()=>{const e=this.itemToPanel(t);e&&(e.classList.add(o.CLS_OPENED),e.focus()),this._isPulldown&&this.alignPanel(t,e),this._isOverflowScroll&&this.assignVisibleHeight(t,e),this._onBeforeOpen&&this._onBeforeOpen(t,e)}),0),this._openItem=t,this._openTime=(new Date).getTime(),this._scrollTop=window.scrollY,this._isOpenedByHover=e}setStateActive(t){if(null===t)for(const t of this._panels)t.classList.remove(o.CLS_ACTIVE);else{const e=t.dataset.panel??t.getAttribute("for")??"";for(const t of this._panels)t.id===e?t.classList.add(o.CLS_ACTIVE):t.classList.remove(o.CLS_ACTIVE)}}clearStateOpened(){if(this._child&&this._child.closeAll(),!this._openItem)return;this._openItem.parentElement.classList.remove(o.CLS_OPENED);const t=this._openItem;setTimeout((()=>{if(t===this._openItem)return;const e=this.itemToPanel(t);e&&e.classList.remove(o.CLS_OPENED)}),400),this._openItem=null}itemToPanel(t){const e=t.dataset.panel??t.getAttribute("for")??"";return e?document.getElementById(e):null}ensureInView(t){const e=t.parentElement.offsetLeft,s=e+t.parentElement.offsetWidth;this._bar.scrollLeft+this._bar.offsetWidth<s&&(this._bar.scrollLeft=s-this._bar.offsetWidth+this._scrollViewOffset),e<this._bar.scrollLeft&&(this._bar.scrollLeft=e-this._scrollViewOffset)}alignPanel(t,e){if(!e)return;if(window.innerWidth<=600)return e.style.left="",e.style.right="",void(this._doSetPanelWidth&&(e.style.minWidth=""));const s=t.getBoundingClientRect(),i=e.getBoundingClientRect(),n=this._panelParent.getBoundingClientRect(),l=i.right-i.left,o=n.right-n.left,r=s.left-n.left,a=o<r+l+16;e.style.left=a?"unset":`${r}px`,e.style.right=a?"0px":"unset",this._doSetPanelWidth&&(e.style.minWidth=s.right-s.left+"px")}assignVisibleHeight(t,e){if(!e)return;const s=window.innerHeight;let i=parseInt(document.documentElement.style.scrollPaddingTop,10);i=isNaN(i)?0:i,e.style.setProperty("--visible-height",null);const n=t.getBoundingClientRect(),l=e.getBoundingClientRect();s-n.height-i<l.height&&e.style.setProperty("--visible-height",s-n.height-i+"px")}}}();
//# sourceMappingURL=global.min.js.map