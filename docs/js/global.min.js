"use strict";function _defineProperty(e,t,s){return t in e?Object.defineProperty(e,t,{value:s,enumerable:!0,configurable:!0,writable:!0}):e[t]=s,e}!function(){window.GIDA=window.GIDA??{},window.GIDA.menu_global=function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};new o(e,t)};const e=[],t=[];const s=[];function n(e){if(e.scrollWidth-e.clientWidth>2){const t=e.scrollLeft/(e.scrollWidth-e.clientWidth);e.classList[t<.95?"add":"remove"]("scrollable-right"),e.classList[.05<t?"add":"remove"]("scrollable-left")}else e.classList.remove("scrollable-right"),e.classList.remove("scrollable-left")}function i(e){let t;function s(){t=!1,e()}return()=>{t||(t=!0,requestAnimationFrame(s))}}function r(e,t){let s=null,n=!1,[i,r,o]=[0,0,0];const l=()=>{n=!1,t()};e.addEventListener("pointerenter",(()=>{n=!0})),e.addEventListener("pointermove",(e=>{n&&.1<(e=>{const[t,s,n]=[e.clientX,e.clientY,e.timeStamp],l=((t-i)*(t-i)+(s-r)*(s-r))/(n-o);return[i,r,o]=[t,s,n],l})(e)&&(clearTimeout(s),s=setTimeout(l,50))})),e.addEventListener("pointerleave",(()=>{clearTimeout(s),n=!1}))}document.addEventListener("DOMContentLoaded",(()=>{window.addEventListener("resize",(()=>{for(const t of e)t()}),{passive:!0}),window.addEventListener("scroll",(()=>{for(const e of t)e()}),{passive:!0}),function(){const e=new ResizeObserver((e=>{for(const t of e)n(t.target)}));for(const t of s)e.observe(t),t.addEventListener("scroll",i((()=>{n(t)})))}()}));class o{constructor(e,n){if(this._root=e?document.getElementById(e):document.querySelector(".gida-menu-global"),!this._root)return;this._openItem=null,this._openTime=0,this._scrollTop=0,this._panels=[],this._st=null,this._canceled=!1,this._startX=0,this._startY=0,this._isOpenedByHover=!1,this._bar=this._root.querySelector(o.SEL_NAV_BAR);const r=this._root.querySelectorAll(".menu > li"),l=this._bar.querySelectorAll("button[data-panel], label[for]");this._panelParent=this._root.querySelector(o.SEL_NAV_PANEL_PARENT),this._alignPanel=this._root.classList.contains("pulldown");const a=n.autoClose??!0,c=n.autoScroll??!0;var h;if(this._doSuppressClickCloseAfterHover=n.doSuppressClickCloseAfterHover??!1,this._scrollViewOffset=n.scrollViewOffset??20,this._defMenuItem=n.defaultMenuItem??null,this._child=n.childNav??null,this._onBeforeOpen=n.onBeforeOpen??null,this._panelParent&&(this._panels=Array.prototype.slice.call(this._panelParent.children)),0<navigator.maxTouchPoints&&this._bar.addEventListener("pointerenter",(e=>{const t="mouse"===e.pointerType?"remove":"add";this._bar.classList[t](o.CLS_TOUCH),this._panelParent.classList[t](o.CLS_TOUCH)})),function(e,t,s){let n=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null,i=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null;const r=e=>{if("mouse"===e.pointerType&&!e.target.classList.contains(t)&&(e.target.classList.add(s),i))for(let t=e.target.parentElement;t&&t!==n;t=t.parentElement)t.classList.contains(s)&&t.classList.add(i)},o=e=>{if("mouse"===e.pointerType&&!e.target.classList.contains(t)&&(e.target.classList.remove(s),i))for(let t=e.target.parentElement;t&&t!==n;t=t.parentElement)t.classList.contains(s)&&t.classList.remove(i)};for(const t of e)t.addEventListener("pointerenter",r),t.addEventListener("pointerleave",o)}(r,o.CLS_CURRENT,o.CLS_HOVER,this._root,o.CLS_HOVER_ANCESTOR),this.addClickStateEventListener(l),this._defMenuItem&&this.open(this._defMenuItem),h=this._bar,s.push(h),a&&(!function(e){arguments.length>1&&void 0!==arguments[1]&&arguments[1]&&e(),t.push(i(e))}((()=>this.onScroll())),this._panelParent&&this._panelParent.addEventListener("click",(e=>e.stopPropagation())),document.addEventListener("click",(()=>this.closeAll()))),c){const e=this._bar.querySelectorAll("a, button[data-panel], label[for]");this.initializeAutoScroll(e)}const d=this._root.querySelectorAll(o.SEL_NAV_CLOSER);for(const e of d)e.addEventListener("click",(()=>this.closeAll()))}initializeAutoScroll(e){for(const t of e){const e=t.parentElement;(e.classList.contains(o.CLS_CURRENT)||e.classList.contains(o.CLS_MENU_ANCESTOR)||e.classList.contains(o.CLS_PAGE_ANCESTOR))&&this.ensureInView(t)}const t=document.createElement("div"),s=document.createElement("div");t.classList.add("scroll-left"),s.classList.add("scroll-right"),this._bar.insertBefore(t,this._bar.firstChild),this._bar.appendChild(s),this.addScrollerEventListener(t,-48),this.addScrollerEventListener(s,48)}addClickStateEventListener(e){for(const t of e)t.addEventListener("click",(e=>{e.stopPropagation()})),r(t,this.createEventListenerEnter(t)),t.addEventListener("pointerdown",this.createEventListenerDown()),t.addEventListener("touchstart",this.createEventListenerTouchStart()),t.addEventListener("pointermove",this.createEventListenerMove()),t.addEventListener("pointercancel",this.createEventListenerCancel()),t.addEventListener("pointerup",this.createEventListenerUp(t)),t.addEventListener("pointerleave",this.createEventListenerLeave()),t.addEventListener("touchend",(e=>{e.cancelable&&e.preventDefault()}));for(const e of this._panels)e.addEventListener("mouseenter",(()=>this.cancelTimeout()))}addScrollerEventListener(e,t){let s=null,n=!1;const r=i((()=>{this._bar.scrollBy(t,0),n&&(s=setTimeout(r,100))}));e.addEventListener("mouseenter",(e=>{e.preventDefault(),n=!0,s=setTimeout(r,100)})),e.addEventListener("mouseleave",(e=>{e.preventDefault(),n=!1,s&&clearTimeout(s),s=null}))}cancelTimeout(){this._st&&clearTimeout(this._st),this._st=null}onScroll(){if((!this._child||!this._child._openItem)&&this._openItem){const e=this._panelParent.querySelector(".gida-menu-global-panel.active.opened");if(!e)return;const t=e.getBoundingClientRect();(t.bottom<0||0<t.top&&t.bottom<Math.abs(window.pageYOffset-this._scrollTop))&&(this.closeAll(),this.cancelTimeout())}}createEventListenerEnter(e){return()=>{e!==this._openItem&&(this.cancelTimeout(),this._st=setTimeout((()=>this.open(e,!0)),100))}}createEventListenerDown(){return e=>{this._canceled=!1,this._startX=e.clientX,this._startY=e.clientY}}createEventListenerTouchStart(){return()=>{this.cancelTimeout(),this._touched=!0}}createEventListenerMove(){return e=>{(10<Math.abs(e.clientX-this._startX)||10<Math.abs(e.clientY-this._startY))&&(this._canceled=!0)}}createEventListenerCancel(){return()=>{this._canceled=!0}}createEventListenerUp(e){return()=>{if(this.cancelTimeout(),this._canceled)return;if(this._touched)return void(e===this._openItem?this.closeAll():this.open(e));const t=(new Date).getTime();if(!(t-this._openTime<200))if(e===this._openItem){if(this._isOpenedByHover){if(this._doSuppressClickCloseAfterHover)return;if(t-this._openTime<400)return}this.closeAll()}else this.open(e)}}createEventListenerLeave(){return()=>{this.cancelTimeout(),this._touched?this._touched=!1:null!==this._openItem&&(this._st=setTimeout((()=>this.closeAll()),800))}}closeAll(){this._suppressCloseAll||(this._defMenuItem?this.open(this._defMenuItem):(this.clearStateOpened(),this.setStateActive(null)))}open(e){let t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];this._suppressCloseAll=!0,document.dispatchEvent(new MouseEvent("click")),this._suppressCloseAll=!1,this.clearStateOpened(),this.setStateActive(e),this.ensureInView(e),e.parentElement.classList.add(o.CLS_OPENED),setTimeout((()=>{const t=this.itemToPanel(e);t&&(t.classList.add(o.CLS_OPENED),t.focus()),this._alignPanel&&this.alignPanel(e,t),this._onBeforeOpen&&this._onBeforeOpen(e,t)}),0),this._openItem=e,this._openTime=(new Date).getTime(),this._scrollTop=window.pageYOffset,this._isOpenedByHover=t}setStateActive(e){if(null===e)for(const e of this._panels)e.classList.remove(o.CLS_ACTIVE);else{const t=e.dataset.panel??e.getAttribute("for")??"";for(const e of this._panels)e.id===t?e.classList.add(o.CLS_ACTIVE):e.classList.remove(o.CLS_ACTIVE)}}clearStateOpened(){if(this._child&&this._child.closeAll(),!this._openItem)return;this._openItem.parentElement.classList.remove(o.CLS_OPENED);const e=this._openItem;setTimeout((()=>{if(e===this._openItem)return;const t=this.itemToPanel(e);t&&t.classList.remove(o.CLS_OPENED)}),400),this._openItem=null}itemToPanel(e){const t=e.dataset.panel??e.getAttribute("for")??"";return t?document.getElementById(t):null}ensureInView(e){const t=e.parentElement.offsetLeft,s=t+e.parentElement.offsetWidth;this._bar.scrollLeft+this._bar.offsetWidth<s&&(this._bar.scrollLeft=s-this._bar.offsetWidth+this._scrollViewOffset),t<this._bar.scrollLeft&&(this._bar.scrollLeft=t-this._scrollViewOffset)}alignPanel(e,t){if(!t)return;if(window.innerWidth<=600)return t.style.left="",void(t.style.right="");const s=e.getBoundingClientRect(),n=t.getBoundingClientRect(),i=this._panelParent.getBoundingClientRect(),r=n.right-n.left,o=i.right-i.left,l=s.left-i.left;o<l+r+16?(t.style.left="unset",t.style.right="0px"):(t.style.left=l+"px",t.style.right="unset")}}_defineProperty(o,"SEL_NAV_BAR",".gida-menu-global-bar"),_defineProperty(o,"SEL_NAV_PANEL_PARENT",".gida-menu-global-panels"),_defineProperty(o,"SEL_NAV_CLOSER",".gida-menu-global-closer"),_defineProperty(o,"CLS_CURRENT","current"),_defineProperty(o,"CLS_MENU_ANCESTOR","menu-ancestor"),_defineProperty(o,"CLS_PAGE_ANCESTOR","page-ancestor"),_defineProperty(o,"CLS_HOVER","hover"),_defineProperty(o,"CLS_TOUCH","touch"),_defineProperty(o,"CLS_ACTIVE","active"),_defineProperty(o,"CLS_OPENED","opened"),_defineProperty(o,"CLS_HOVER_ANCESTOR","hover-ancestor")}();
//# sourceMappingURL=global.min.js.map