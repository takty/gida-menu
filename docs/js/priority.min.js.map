{"version":3,"sources":["priority.js"],"names":["window","menu_priority","id","arguments","length","undefined","opts","NS","CLS_PANELS","CLS_PANEL","CLS_BUTTON","CLS_ACTIVE","CLS_OPENED","CP_MAX_WIDTH","root","document","getElementById","getElementsByClassName","menuBar","querySelector","getElementsByTagName","lis","Array","from","querySelectorAll","menuBarStyle","getComputedStyle","autoClose","reversed","btnPos","order","ws","i","getWeightFromClass","sort","a","b","reverse","initOrder","scrollTop","columnGap","scrollListeners","scrollableDetectionTargets","initializeScrollableDetection","rob","ResizeObserver","oes","oe","detectScrollable","target","tar","observe","addEventListener","throttle","elm","scrollWidth","clientWidth","r","scrollLeft","classList","remove","fn","isRunning","run","requestAnimationFrame","l","passive","panel","menuPanel","panelParent","createElement","add","menu","appendChild","initPanel","liBtn","btn","item","initButton","append","prepend","e","contains","close","setTimeout","scrollY","open","stopPropagation","li","items","clsCurrent","clsHover","clsHoverAncestor","enter","pointerType","parentElement","leave","it","addHoverStateEventListener","def","cs","className","split","w","c","n","parseInt","isNaN","alignItems","style","width","barW","Math","floor","getBoundingClientRect","inBar","withPanel","fill","sumW","reduce","s","v","toPanel","calcItemPlace","display","getPropertyValue","trim","offsetWidth","insertBefore","Number","map","p","parseFloat","paddingLeft","paddingRight","setProperty","setMaxWidth","push","onScroll","bcr","bottom","top","abs","doOnScroll"],"mappings":"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","file":"priority.min.js","sourcesContent":["/**\n * Gida Menu - Priority\n *\n * @author Takuto Yanagida\n * @version 2023-07-06\n */\n\nwindow['GIDA'] = window['GIDA'] ?? {};\n\nwindow['GIDA'].menu_priority = function (id = null, opts = {}) {\n\tconst NS         = 'gida-menu-priority';\n\tconst CLS_PANELS = NS + '-panels';\n\tconst CLS_PANEL  = NS + '-panel';\n\tconst CLS_BUTTON = NS + '-button';\n\n\tconst CLS_CURRENT = 'current';\n\n\tconst CLS_READY  = 'ready';\n\tconst CLS_HOVER  = 'hover';\n\tconst CLS_ACTIVE = 'active';\n\tconst CLS_OPENED = 'opened';\n\n\tconst CP_MAX_WIDTH = '--max-width';\n\tconst CP_FOLDABLE  = '--foldable';\n\n\tconst root = id ? document.getElementById(id) : document.getElementsByClassName(NS)[0];\n\tif (!root) return;\n\tconst menuBar = root.querySelector('.menu') ?? root.getElementsByTagName('ul')[0];\n\tif (!menuBar) return;\n\tconst lis = Array.from(menuBar.querySelectorAll(':scope > li'));\n\n\tconst menuBarStyle = getComputedStyle(menuBar);\n\tconst autoClose    = opts['autoClose']      ?? true;\n\tconst reversed     = opts['reversed']       ?? false;\n\tconst btnPos       = opts['buttonPosition'] ?? 'end';  // 'start' or 'end';\n\n\tconst order = initOrder(lis, reversed);\n\n\tlet scrollTop = 0;\n\tlet columnGap = 0;\n\n\n\t// -------------------------------------------------------------------------\n\n\n\t/**\n\t * Common Functions\n\t *\n\t * @author Takuto Yanagida\n\t * @version 2023-07-06\n\t */\n\t\n\tconst scrollListeners = [];\n\t\n\tfunction onScroll(fn, doFirst = false) {\n\t\tif (doFirst) fn();\n\t\tscrollListeners.push(throttle(fn));\n\t}\n\t\n\t\n\t// -----------------------------------------------------------------------------\n\t\n\t\n\tconst scrollableDetectionTargets = [];\n\t\n\tfunction addScrollableDetectionTarget(tar) {\n\t\tscrollableDetectionTargets.push(tar);\n\t}\n\t\n\tfunction initializeScrollableDetection() {\n\t\tconst rob = new ResizeObserver(oes => {\n\t\t\tfor (const oe of oes) detectScrollable(oe.target);\n\t\t});\n\t\tfor (const tar of scrollableDetectionTargets) {\n\t\t\trob.observe(tar);\n\t\t\ttar.addEventListener('scroll', throttle(() => { detectScrollable(tar); }));\n\t\t}\n\t\tscrollableDetectionTargets.length = 0;\n\t}\n\t\n\tfunction detectScrollable(elm) {\n\t\tif (elm.scrollWidth - elm.clientWidth > 2) {  // for avoiding needless scrolling\n\t\t\tconst r = elm.scrollLeft / (elm.scrollWidth - elm.clientWidth);\n\t\t\telm.classList[r < 0.95 ? 'add' : 'remove']('scrollable-right');\n\t\t\telm.classList[0.05 < r ? 'add' : 'remove']('scrollable-left');\n\t\t} else {\n\t\t\telm.classList.remove('scrollable-right');\n\t\t\telm.classList.remove('scrollable-left');\n\t\t}\n\t}\n\t\n\t\n\t// -----------------------------------------------------------------------------\n\t\n\t\n\tfunction addHoverStateEventListener(items, clsCurrent, clsHover, root = null, clsHoverAncestor = null) {\n\t\tconst enter = (e) => {\n\t\t\tif (e.pointerType === 'mouse' && !e.target.classList.contains(clsCurrent)) {\n\t\t\t\te.target.classList.add(clsHover);\n\t\t\t\tif (clsHoverAncestor) {\n\t\t\t\t\tfor (let elm = e.target.parentElement; elm && elm !== root; elm = elm.parentElement) {\n\t\t\t\t\t\tif (elm.classList.contains(clsHover)) {\n\t\t\t\t\t\t\telm.classList.add(clsHoverAncestor);\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t\tconst leave = (e) => {\n\t\t\tif (e.pointerType === 'mouse' && !e.target.classList.contains(clsCurrent)) {\n\t\t\t\te.target.classList.remove(clsHover);\n\t\t\t\tif (clsHoverAncestor) {\n\t\t\t\t\tfor (let elm = e.target.parentElement; elm && elm !== root; elm = elm.parentElement) {\n\t\t\t\t\t\tif (elm.classList.contains(clsHover)) {\n\t\t\t\t\t\t\telm.classList.remove(clsHoverAncestor);\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t\tfor (const it of items) {\n\t\t\tit.addEventListener('pointerenter', enter);\n\t\t\tit.addEventListener('pointerleave', leave);\n\t\t}\n\t}\n\t\n\t\n\t// -----------------------------------------------------------------------------\n\t\n\t\n\tdocument.addEventListener('DOMContentLoaded', () => {\n\t\twindow.addEventListener('scroll', () => { for (const l of scrollListeners) l(); }, { passive: true });\n\t\tinitializeScrollableDetection();\n\t\twindow.addEventListener('load', initializeScrollableDetection);\n\t});\n\t\n\tfunction throttle(fn) {\n\t\tlet isRunning;\n\t\tfunction run() {\n\t\t\tisRunning = false;\n\t\t\tfn();\n\t\t}\n\t\treturn () => {\n\t\t\tif (isRunning) return;\n\t\t\tisRunning = true;\n\t\t\trequestAnimationFrame(run);\n\t\t};\n\t}\n\t\n\n\n\t// -------------------------------------------------------------------------\n\n\n\tconst [panel, menuPanel] = initPanel(root);\n\tconst [liBtn, btn]       = initButton(menuBar);\n\n\tif ('end' === btnPos) {\n\t\tmenuBar.append(liBtn);\n\t} else if ('start' === btnPos) {\n\t\tmenuBar.prepend(liBtn);\n\t}\n\n\tbtn.addEventListener('click', (e) => {\n\t\tif (liBtn.classList.contains(CLS_OPENED)) {\n\t\t\tclose(liBtn, panel);\n\t\t} else {\n\t\t\topen(liBtn, panel);\n\t\t}\n\t\te.stopPropagation();\n\t});\n\tfor (const li of lis) {\n\t\tli.addEventListener('click', () => { close(liBtn, panel); });\n\t}\n\taddHoverStateEventListener(lis, CLS_CURRENT, CLS_HOVER);\n\n\tlet ws = [];\n\tsetTimeout(() => {\n\t\tws        = lis.map((e) => e.offsetWidth);\n\t\tcolumnGap = parseInt(menuBarStyle.columnGap, 10);\n\t\tcolumnGap = Number.isNaN(columnGap) ? 0 : columnGap;\n\t\talignItems(ws, menuBar, menuPanel, lis, liBtn);\n\t\tconst rob = new ResizeObserver(() => {\n\t\t\trequestAnimationFrame(() => {\n\t\t\t\tclose(liBtn, panel);\n\t\t\t\tsetMaxWidth(root);\n\t\t\t\talignItems(ws, menuBar, menuPanel, lis, liBtn);\n\t\t\t});\n\t\t});\n\t\trob.observe(root);\n\t\trob.observe(root.parentElement);\n\t}, 10);\n\tsetTimeout(() => { root.classList.add(CLS_READY); }, 100);\n\n\tif (autoClose) {\n\t\tonScroll(() => { doOnScroll(liBtn, panel); });\n\t\tdocument.addEventListener('click', () => { close(liBtn, panel); });\n\t}\n\n\n\t// -------------------------------------------------------------------------\n\n\n\tfunction initOrder(lis, reversed) {\n\t\tconst ws = new Array(lis.length);\n\t\tfor (let i = 0; i < lis.length; i += 1) {\n\t\t\tws[i] = getWeightFromClass(lis[i], lis.length - i);\n\t\t}\n\t\tconst order = new Array(lis.length);\n\t\tfor (let i = 0; i < lis.length; i += 1) order[i] = i;\n\t\torder.sort((a, b) => ws[a] < ws[b] ? 1 : ws[a] > ws[b] ? -1 : 0);\n\n\t\tif (reversed) {\n\t\t\torder.reverse();\n\t\t}\n\t\treturn order;\n\t}\n\n\tfunction getWeightFromClass(li, def) {\n\t\tconst cs = li.className.split(' ');\n\t\tlet w = null;\n\t\tfor (const c of cs) {\n\t\t\tconst n = parseInt(c, 10);\n\t\t\tif (isNaN(n)) continue;\n\t\t\tif (null === w || w < n) w = n;\n\t\t}\n\t\treturn w ?? def;\n\t}\n\n\tfunction initPanel(root) {\n\t\tconst panelParent = document.createElement('div');\n\t\tpanelParent.classList.add(CLS_PANELS);\n\n\t\tconst panel = document.createElement('div');\n\t\tpanel.classList.add(CLS_PANEL);\n\t\tif ('end' === btnPos || 'start' === btnPos) {\n\t\t\tpanel.classList.add('end' === btnPos ? 'end' : 'start');\n\t\t}\n\n\t\tconst menu = document.createElement('ul');\n\t\tmenu.classList.add('menu');\n\n\t\tpanel.appendChild(menu);\n\t\tpanelParent.appendChild(panel);\n\t\troot.appendChild(panelParent);\n\t\treturn [panel, menu];\n\t}\n\n\tfunction initButton(menuBar) {\n\t\tconst btn = document.createElement('button');\n\t\tbtn.classList.add(CLS_BUTTON);\n\t\tconst item = document.createElement('li');\n\t\titem.appendChild(btn);\n\t\tmenuBar.appendChild(item);\n\t\treturn [item, btn];\n\t}\n\n\n\t// -------------------------------------------------------------------------\n\n\n\tfunction close(liBtn, panel) {\n\t\tliBtn.classList.remove(CLS_OPENED);\n\t\tpanel.classList.remove(CLS_ACTIVE);\n\t\tsetTimeout(() => {\n\t\t\tpanel.classList.remove(CLS_OPENED);\n\t\t}, 400);\n\t}\n\n\tfunction open(liBtn, panel) {\n\t\tliBtn.classList.add(CLS_OPENED);\n\t\tpanel.classList.add(CLS_ACTIVE);\n\t\tsetTimeout(() => {\n\t\t\tpanel.classList.add(CLS_OPENED);\n\t\t}, 0);\n\t\tscrollTop = window.scrollY;\n\t}\n\n\tfunction doOnScroll(liBtn, panel) {\n\t\tconst bcr = panel.getBoundingClientRect();\n\t\tif (\n\t\t\tbcr.bottom < 0 ||  // When not fixed\n\t\t\t(0 < bcr.top && bcr.bottom < Math.abs(window.scrollY - scrollTop))  // When fixed\n\t\t) {\n\t\t\tclose(liBtn, panel);\n\t\t}\n\t}\n\n\tfunction setMaxWidth(root) {\n\t\tconst p  = root.parentElement;\n\t\tconst cs = getComputedStyle(p);\n\t\tconst w  = p.clientWidth - (parseFloat(cs.paddingLeft) + parseFloat(cs.paddingRight));\n\t\troot.style.setProperty(CP_MAX_WIDTH, `${Math.floor(w)}px`);\n\t}\n\n\tfunction alignItems(ws, menuBar, menuPanel, lis, liBtn) {\n\t\tmenuBar.style.width = '0';\n\t\tconst barW = Math.floor(menuBar.parentElement.getBoundingClientRect().width);\n\t\tmenuBar.style.width = null;\n\n\t\tconst [inBar, withPanel] = calcItemPlace(barW, ws, lis, liBtn, columnGap);\n\t\tliBtn.style.display = withPanel ? null : 'none';\n\n\t\tif ('false' === getComputedStyle(menuBar).getPropertyValue(CP_FOLDABLE).trim()) {\n\t\t\tinBar.fill(true);\n\t\t\tliBtn.style.display = 'none';\n\t\t}\n\n\t\tfor (let i = 0; i < lis.length; i += 1) {\n\t\t\tif (!inBar[i]) continue;\n\t\t\tif (lis[i].parentElement === menuBar) {\n\t\t\t\tws[i] = lis[i].offsetWidth;\n\t\t\t}\n\t\t\tif ('end' === btnPos) {\n\t\t\t\tmenuBar.insertBefore(lis[i], liBtn);\n\t\t\t} else if ('start' === btnPos) {\n\t\t\t\tmenuBar.appendChild(lis[i], liBtn);\n\t\t\t}\n\t\t}\n\n\t\tcolumnGap = parseInt(menuBarStyle.columnGap, 10);\n\t\tcolumnGap = Number.isNaN(columnGap) ? 0 : columnGap;\n\n\t\tfor (let i = 0; i < lis.length; i += 1) {\n\t\t\tif (!inBar[i]) menuPanel.appendChild(lis[i]);\n\t\t}\n\t}\n\n\tfunction calcItemPlace(barW, ws, lis, liBtn, columnGap) {\n\t\tconst inBar = new Array(lis.length);\n\t\tinBar.fill(true);\n\n\t\tconst sumW = ws.reduce((s, v) => s + v) + (columnGap * (ws.length - 1));\n\n\t\tif (barW < sumW) {\n\t\t\tbarW -= liBtn.clientWidth;\n\n\t\t\tlet toPanel = lis.length;\n\t\t\tfor (let i = 0; i < lis.length; i += 1) {\n\t\t\t\tif ((barW -= ws[order[i]] + columnGap) < 0) {\n\t\t\t\t\ttoPanel = i;\n\t\t\t\t\tbreak;\n\t\t\t\t}\n\t\t\t}\n\t\t\tfor (let i = toPanel; i < lis.length; i += 1) {\n\t\t\t\tinBar[order[i]] = false;\n\t\t\t}\n\t\t}\n\t\treturn [inBar, barW < sumW];\n\t}\n\n};\n"]}