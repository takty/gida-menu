{"version":3,"sources":["priority.js"],"names":["window","menu_priority","id","opts","NS","CLS_ACTIVE","CLS_OPENED","root","document","getElementById","getElementsByClassName","menuBar","querySelector","getElementsByTagName","lis","Array","from","querySelectorAll","autoClose","scrollTop","resizeListeners","scrollListeners","scrollableDetectionTargets","detectScrollable","elm","scrollWidth","clientWidth","r","scrollLeft","classList","remove","throttle","fn","isRunning","run","requestAnimationFrame","addEventListener","l","passive","rob","ResizeObserver","oes","oe","target","tar","observe","initializeScrollableDetection","panel","menuPanel","panelParent","createElement","add","menu","appendChild","initPanel","liBtn","btn","item","initButton","e","contains","close","setTimeout","pageYOffset","open","stopPropagation","li","items","clsCurrent","clsHover","enter","pointerType","leave","it","addHoverStateEventListener","ws","alignItems","remW","parentElement","getBoundingClientRect","width","sep","length","btnW","reduce","s","v","i","offsetWidth","insertBefore","style","display","map","doFirst","push","onResize","onScroll","bcr","bottom","top","Math","abs","doOnScroll"],"mappings":"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","file":"priority.min.js","sourcesContent":["/**\n *\n * Gida Menu - Priority (JS)\n *\n * @author Takuto Yanagida\n * @version 2021-09-28\n *\n */\n\n\nwindow['GIDA'] = window['GIDA'] ?? {};\n\n\nwindow['GIDA'].menu_priority = function (id = null, opts = {}) {\n\tconst NS         = 'gida-menu-priority';\n\tconst CLS_PANELS = NS + '-panels';\n\tconst CLS_PANEL  = NS + '-panel';\n\tconst CLS_BUTTON = NS + '-button';\n\n\tconst CLS_CURRENT = 'current';\n\n\tconst CLS_READY  = 'ready';\n\tconst CLS_HOVER  = 'hover';\n\tconst CLS_ACTIVE = 'active';\n\tconst CLS_OPENED = 'opened';\n\n\tconst root = id ? document.getElementById(id) : document.getElementsByClassName(NS)[0];\n\tif (!root) return;\n\n\tconst menuBar = root.querySelector('.menu') ?? root.getElementsByTagName('ul')[0];\n\tconst lis     = Array.from(menuBar.querySelectorAll('li'));\n\n\tconst autoClose = opts['autoClose'] ?? true;\n\n\tlet scrollTop = 0;\n\n\n\t// -------------------------------------------------------------------------\n\n\n\t/**\n\t *\n\t * Common Functions (JS)\n\t *\n\t * @author Takuto Yanagida\n\t * @version 2021-09-26\n\t *\n\t */\n\t\n\t\n\tconst resizeListeners = [];\n\tconst scrollListeners = [];\n\t\n\tfunction onResize(fn, doFirst = false) {\n\t\tif (doFirst) fn();\n\t\tresizeListeners.push(throttle(fn));\n\t}\n\t\n\tfunction onScroll(fn, doFirst = false) {\n\t\tif (doFirst) fn();\n\t\tscrollListeners.push(throttle(fn));\n\t}\n\t\n\t\n\t// -----------------------------------------------------------------------------\n\t\n\t\n\tconst scrollableDetectionTargets = [];\n\t\n\tfunction addScrollableDetectionTarget(tar) {\n\t\tscrollableDetectionTargets.push(tar);\n\t}\n\t\n\tfunction initializeScrollableDetection() {\n\t\tconst rob = new ResizeObserver(oes => {\n\t\t\tfor (const oe of oes) detectScrollable(oe.target);\n\t\t});\n\t\tfor (const tar of scrollableDetectionTargets) {\n\t\t\trob.observe(tar);\n\t\t\ttar.addEventListener('scroll', throttle(() => { detectScrollable(tar); }));\n\t\t}\n\t}\n\t\n\tfunction detectScrollable(elm) {\n\t\tif (elm.scrollWidth - elm.clientWidth > 2) {  // for avoiding needless scrolling\n\t\t\tconst r = elm.scrollLeft / (elm.scrollWidth - elm.clientWidth);\n\t\t\telm.classList[r < 0.95 ? 'add' : 'remove']('scrollable-right');\n\t\t\telm.classList[0.05 < r ? 'add' : 'remove']('scrollable-left');\n\t\t} else {\n\t\t\telm.classList.remove('scrollable-right');\n\t\t\telm.classList.remove('scrollable-left');\n\t\t}\n\t}\n\t\n\t\n\t// -----------------------------------------------------------------------------\n\t\n\t\n\tfunction addHoverStateEventListener(items, clsCurrent, clsHover) {\n\t\tconst enter = (e) => {\n\t\t\tif (e.pointerType === 'mouse' && !e.target.classList.contains(clsCurrent)) {\n\t\t\t\te.target.classList.add(clsHover);\n\t\t\t}\n\t\t}\n\t\tconst leave = (e) => {\n\t\t\tif (e.pointerType === 'mouse' && !e.target.classList.contains(clsCurrent)) {\n\t\t\t\te.target.classList.remove(clsHover);\n\t\t\t}\n\t\t}\n\t\tfor (const it of items) {\n\t\t\tit.addEventListener('pointerenter', enter);\n\t\t\tit.addEventListener('pointerleave', leave);\n\t\t}\n\t}\n\t\n\t\n\t// -----------------------------------------------------------------------------\n\t\n\t\n\tdocument.addEventListener('DOMContentLoaded', () => {\n\t\twindow.addEventListener('resize', () => { for (const l of resizeListeners) l(); }, { passive: true });\n\t\twindow.addEventListener('scroll', () => { for (const l of scrollListeners) l(); }, { passive: true });\n\t\tinitializeScrollableDetection();\n\t});\n\t\n\tfunction throttle(fn) {\n\t\tlet isRunning;\n\t\tfunction run() {\n\t\t\tisRunning = false;\n\t\t\tfn();\n\t\t}\n\t\treturn () => {\n\t\t\tif (isRunning) return;\n\t\t\tisRunning = true;\n\t\t\trequestAnimationFrame(run);\n\t\t};\n\t}\n\t\n\n\n\t// -------------------------------------------------------------------------\n\n\n\tconst [panel, menuPanel] = initPanel(root);\n\tconst [liBtn, btn]       = initButton(menuBar);\n\n\tmenuBar.appendChild(liBtn);\n\n\tbtn.addEventListener('click', (e) => {\n\t\tif (liBtn.classList.contains(CLS_OPENED)) {\n\t\t\tclose(liBtn, panel);\n\t\t} else {\n\t\t\topen(liBtn, panel);\n\t\t}\n\t\te.stopPropagation();\n\t});\n\tfor (const li of lis) {\n\t\tli.addEventListener('click', () => { close(liBtn, panel); });\n\t}\n\taddHoverStateEventListener(lis, CLS_CURRENT, CLS_HOVER);\n\n\tlet ws = [];\n\tsetTimeout(() => {\n\t\tws = lis.map((e) => e.offsetWidth);\n\t\talignItems(ws, menuBar, menuPanel, lis, liBtn);\n\t\tonResize(() => { alignItems(ws, menuBar, menuPanel, lis, liBtn); });\n\t}, 10);\n\tsetTimeout(() => { root.classList.add(CLS_READY); }, 100);\n\n\tif (autoClose) {\n\t\tonScroll(() => { doOnScroll(liBtn, panel); });\n\t\tdocument.addEventListener('click', () => { close(liBtn, panel); });\n\t}\n\n\n\t// -------------------------------------------------------------------------\n\n\n\tfunction initPanel(root) {\n\t\tconst panelParent = document.createElement('div');\n\t\tpanelParent.classList.add(CLS_PANELS);\n\n\t\tconst panel = document.createElement('div');\n\t\tpanel.classList.add(CLS_PANEL);\n\n\t\tconst menu = document.createElement('ul');\n\t\tmenu.classList.add('menu');\n\n\t\tpanel.appendChild(menu);\n\t\tpanelParent.appendChild(panel);\n\t\troot.appendChild(panelParent);\n\t\treturn [panel, menu];\n\t}\n\n\tfunction initButton(menuBar) {\n\t\tconst btn = document.createElement('button');\n\t\tbtn.classList.add(CLS_BUTTON);\n\t\tconst item = document.createElement('li');\n\t\titem.appendChild(btn);\n\t\tmenuBar.appendChild(item);\n\t\treturn [item, btn];\n\t}\n\n\n\t// -------------------------------------------------------------------------\n\n\n\tfunction close(liBtn, panel) {\n\t\tliBtn.classList.remove(CLS_OPENED);\n\t\tpanel.classList.remove(CLS_ACTIVE);\n\t\tsetTimeout(() => {\n\t\t\tpanel.classList.remove(CLS_OPENED);\n\t\t}, 400);\n\t}\n\n\tfunction open(liBtn, panel) {\n\t\tliBtn.classList.add(CLS_OPENED);\n\t\tpanel.classList.add(CLS_ACTIVE);\n\t\tsetTimeout(() => {\n\t\t\tpanel.classList.add(CLS_OPENED);\n\t\t}, 0);\n\t\tscrollTop = window.pageYOffset;\n\t}\n\n\tfunction doOnScroll(liBtn, panel) {\n\t\tconst bcr = panel.getBoundingClientRect();\n\t\tif (\n\t\t\tbcr.bottom < 0 ||  // When not fixed\n\t\t\t(0 < bcr.top && bcr.bottom < Math.abs(window.pageYOffset - scrollTop))  // When fixed\n\t\t) {\n\t\t\tclose(liBtn, panel);\n\t\t}\n\t}\n\n\tfunction alignItems(ws, menuBar, menuPanel, lis, liBtn) {\n\t\tlet remW = menuBar.parentElement.getBoundingClientRect().width;\n\t\tlet sep  = lis.length;\n\n\t\tconst btnW = liBtn.clientWidth;\n\t\tconst sum  = ws.reduce((s, v) => s + v);\n\n\t\tif (remW < sum) {\n\t\t\tremW -= btnW;\n\t\t\tfor (let i = 0; i < ws.length; i += 1) {\n\t\t\t\tif ((remW -= ws[i]) < 0) {\n\t\t\t\t\tsep = i;\n\t\t\t\t\tbreak;\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t\tfor (let i = 0; i < sep; i += 1) {\n\t\t\tif (lis[i].parentElement === menuBar) {\n\t\t\t\tws[i] = lis[i].offsetWidth;\n\t\t\t} else {\n\t\t\t\tmenuBar.insertBefore(lis[i], liBtn);\n\t\t\t}\n\t\t}\n\t\tfor (let i = sep; i < lis.length; i += 1) menuPanel.appendChild(lis[i]);\n\t\tliBtn.style.display = (sep === lis.length) ? 'none' : '';\n\t}\n\n};\n"]}