{"version":3,"sources":["priority.js"],"names":["window","GIDA","menu_priority","id","opts","NS","CLS_BAR","CLS_PANELS","CLS_PANEL","CLS_BUTTON","CLS_STATE_READY","CLS_STATE_ACTIVE","CLS_STATE_OPENED","root","document","getElementById","getElementsByClassName","menuBar","querySelector","getElementsByTagName","lis","Array","from","querySelectorAll","autoClose","scrollTop","resizeListeners","scrollListeners","onResize","fn","doFirst","push","throttle","onScroll","scrollableDetectionTargets","addScrollableDetectionTarget","tar","initializeScrollableDetection","rob","ResizeObserver","oes","oe","detectScrollable","target","observe","addEventListener","elm","scrollWidth","clientWidth","r","scrollLeft","classList","remove","l","passive","isRunning","run","requestAnimationFrame","panel","menuPanel","initPanel","liBtn","btn","initButton","appendChild","e","contains","close","open","stopPropagation","li","ws","setTimeout","map","offsetWidth","alignItems","add","doOnScroll","panelParent","createElement","menu","item","pageYOffset","bcr","getBoundingClientRect","bottom","top","Math","abs","remW","parentElement","width","sep","length","btnW","sum","reduce","s","v","i","insertBefore","style","display"],"mappings":"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","sourcesContent":["/**\r\n *\r\n * Gida Menu - Priority (JS)\r\n *\r\n * @author Takuto Yanagida\r\n * @version 2021-07-05\r\n *\r\n */\r\n\r\n\r\nwindow.GIDA = window['GIDA'] ?? {};\r\n\r\n\r\nwindow.GIDA.menu_priority = function (id, opts) {\r\n\tconst NS         = 'gida-menu-priority';\r\n\tconst CLS_BAR    = NS + '-bar';\r\n\tconst CLS_PANELS = NS + '-panels';\r\n\tconst CLS_PANEL  = NS + '-panel';\r\n\tconst CLS_BUTTON = NS + '-button';\r\n\r\n\tconst CLS_STATE_READY  = 'ready';\r\n\tconst CLS_STATE_ACTIVE = 'active';\r\n\tconst CLS_STATE_OPENED = 'opened';\r\n\r\n\tconst root = id ? document.getElementById(id) : document.getElementsByClassName(NS)[0];\r\n\tif (!root) return;\r\n\r\n\tconst menuBar = root.querySelector('.menu') ?? root.getElementsByTagName('ul')[0];\r\n\tconst lis     = Array.from(menuBar.querySelectorAll('li'));\r\n\r\n\tconst autoClose = opts['autoClose'] ?? true;\r\n\r\n\tlet scrollTop = 0;\r\n\r\n\r\n\t// -------------------------------------------------------------------------\r\n\r\n\r\n\t/**\r\n\t *\r\n\t * Common Functions (JS)\r\n\t *\r\n\t * @author Takuto Yanagida\r\n\t * @version 2021-06-30\r\n\t *\r\n\t */\r\n\t\r\n\t\r\n\tconst resizeListeners = [];\r\n\tconst scrollListeners = [];\r\n\t\r\n\tfunction onResize(fn, doFirst = false) {\r\n\t\tif (doFirst) fn();\r\n\t\tresizeListeners.push(throttle(fn));\r\n\t}\r\n\t\r\n\tfunction onScroll(fn, doFirst = false) {\r\n\t\tif (doFirst) fn();\r\n\t\tscrollListeners.push(throttle(fn));\r\n\t}\r\n\t\r\n\t\r\n\t// -----------------------------------------------------------------------------\r\n\t\r\n\t\r\n\tconst scrollableDetectionTargets = [];\r\n\t\r\n\tfunction addScrollableDetectionTarget(tar) {\r\n\t\tscrollableDetectionTargets.push(tar);\r\n\t}\r\n\t\r\n\tfunction initializeScrollableDetection() {\r\n\t\tconst rob = new ResizeObserver(oes => {\r\n\t\t\tfor (const oe of oes) detectScrollable(oe.target);\r\n\t\t});\r\n\t\tfor (const tar of scrollableDetectionTargets) {\r\n\t\t\trob.observe(tar);\r\n\t\t\ttar.addEventListener('scroll', throttle(() => { detectScrollable(tar); }));\r\n\t\t}\r\n\t}\r\n\t\r\n\tfunction detectScrollable(elm) {\r\n\t\tif (elm.scrollWidth - elm.clientWidth > 2) {  // for avoiding needless scrolling\r\n\t\t\tconst r = elm.scrollLeft / (elm.scrollWidth - elm.clientWidth);\r\n\t\t\telm.classList[r < 0.95 ? 'add' : 'remove']('scrollable-right');\r\n\t\t\telm.classList[0.05 < r ? 'add' : 'remove']('scrollable-left');\r\n\t\t} else {\r\n\t\t\telm.classList.remove('scrollable-right');\r\n\t\t\telm.classList.remove('scrollable-left');\r\n\t\t}\r\n\t}\r\n\t\r\n\t\r\n\t// -----------------------------------------------------------------------------\r\n\t\r\n\t\r\n\tdocument.addEventListener('DOMContentLoaded', () => {\r\n\t\twindow.addEventListener('resize', () => { for (const l of resizeListeners) l(); }, { passive: true });\r\n\t\twindow.addEventListener('scroll', () => { for (const l of scrollListeners) l(); }, { passive: true });\r\n\t\tinitializeScrollableDetection();\r\n\t});\r\n\t\r\n\tfunction throttle(fn) {\r\n\t\tlet isRunning;\r\n\t\tfunction run() {\r\n\t\t\tisRunning = false;\r\n\t\t\tfn();\r\n\t\t}\r\n\t\treturn () => {\r\n\t\t\tif (isRunning) return;\r\n\t\t\tisRunning = true;\r\n\t\t\trequestAnimationFrame(run);\r\n\t\t};\r\n\t}\r\n\t\r\n\r\n\r\n\t// -------------------------------------------------------------------------\r\n\r\n\r\n\tconst [panel, menuPanel] = initPanel(root);\r\n\tconst [liBtn, btn]       = initButton(menuBar);\r\n\r\n\tmenuBar.appendChild(liBtn);\r\n\r\n\tbtn.addEventListener('click', (e) => {\r\n\t\tif (liBtn.classList.contains(CLS_STATE_OPENED)) {\r\n\t\t\tclose(liBtn, panel);\r\n\t\t} else {\r\n\t\t\topen(liBtn, panel);\r\n\t\t}\r\n\t\te.stopPropagation();\r\n\t});\r\n\tfor (const li of lis) {\r\n\t\tli.addEventListener('click', () => { close(liBtn, panel); });\r\n\t}\r\n\r\n\tlet ws = [];\r\n\tsetTimeout(() => {\r\n\t\tws = lis.map((e) => e.offsetWidth);\r\n\t\talignItems(ws, menuBar, menuPanel, lis, liBtn);\r\n\t\tonResize(() => { alignItems(ws, menuBar, menuPanel, lis, liBtn); });\r\n\t}, 10);\r\n\tsetTimeout(() => { root.classList.add(CLS_STATE_READY); }, 100);\r\n\r\n\tif (autoClose) {\r\n\t\tonScroll(() => { doOnScroll(liBtn, panel); });\r\n\t\tdocument.addEventListener('click', () => { close(liBtn, panel); });\r\n\t}\r\n\r\n\r\n\t// -------------------------------------------------------------------------\r\n\r\n\r\n\tfunction initPanel(root) {\r\n\t\tconst panelParent = document.createElement('div');\r\n\t\tpanelParent.classList.add(CLS_PANELS);\r\n\r\n\t\tconst panel = document.createElement('div');\r\n\t\tpanel.classList.add(CLS_PANEL);\r\n\r\n\t\tconst menu = document.createElement('ul');\r\n\t\tmenu.classList.add('menu');\r\n\r\n\t\tpanel.appendChild(menu);\r\n\t\tpanelParent.appendChild(panel);\r\n\t\troot.appendChild(panelParent);\r\n\t\treturn [panel, menu];\r\n\t}\r\n\r\n\tfunction initButton(menuBar) {\r\n\t\tconst btn = document.createElement('button');\r\n\t\tbtn.classList.add(CLS_BUTTON);\r\n\t\tconst item = document.createElement('li');\r\n\t\titem.appendChild(btn);\r\n\t\tmenuBar.appendChild(item);\r\n\t\treturn [item, btn];\r\n\t}\r\n\r\n\r\n\t// -------------------------------------------------------------------------\r\n\r\n\r\n\tfunction close(liBtn, panel) {\r\n\t\tliBtn.classList.remove(CLS_STATE_OPENED);\r\n\t\tpanel.classList.remove(CLS_STATE_ACTIVE);\r\n\t\tsetTimeout(() => {\r\n\t\t\tpanel.classList.remove(CLS_STATE_OPENED);\r\n\t\t}, 400);\r\n\t}\r\n\r\n\tfunction open(liBtn, panel) {\r\n\t\tliBtn.classList.add(CLS_STATE_OPENED);\r\n\t\tpanel.classList.add(CLS_STATE_ACTIVE);\r\n\t\tsetTimeout(() => {\r\n\t\t\tpanel.classList.add(CLS_STATE_OPENED);\r\n\t\t}, 0);\r\n\t\tscrollTop = window.pageYOffset;\r\n\t}\r\n\r\n\tfunction doOnScroll(liBtn, panel) {\r\n\t\tconst bcr = panel.getBoundingClientRect();\r\n\t\tif (\r\n\t\t\tbcr.bottom < 0 ||  // When not fixed\r\n\t\t\t(0 < bcr.top && bcr.bottom < Math.abs(window.pageYOffset - scrollTop))  // When fixed\r\n\t\t) {\r\n\t\t\tclose(liBtn, panel);\r\n\t\t}\r\n\t}\r\n\r\n\tfunction alignItems(ws, menuBar, menuPanel, lis, liBtn) {\r\n\t\tlet remW = menuBar.parentElement.getBoundingClientRect().width;\r\n\t\tlet sep  = lis.length;\r\n\r\n\t\tconst btnW = liBtn.clientWidth;\r\n\t\tconst sum  = ws.reduce((s, v) => s + v);\r\n\r\n\t\tif (remW < sum) {\r\n\t\t\tremW -= btnW;\r\n\t\t\tfor (let i = 0; i < ws.length; i += 1) {\r\n\t\t\t\tif ((remW -= ws[i]) < 0) {\r\n\t\t\t\t\tsep = i;\r\n\t\t\t\t\tbreak;\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\t\tfor (let i = 0; i < sep; i += 1) {\r\n\t\t\tif (lis[i].parentElement === menuBar) {\r\n\t\t\t\tws[i] = lis[i].offsetWidth;\r\n\t\t\t} else {\r\n\t\t\t\tmenuBar.insertBefore(lis[i], liBtn);\r\n\t\t\t}\r\n\t\t}\r\n\t\tfor (let i = sep; i < lis.length; i += 1) menuPanel.appendChild(lis[i]);\r\n\t\tliBtn.style.display = (sep === lis.length) ? 'none' : '';\r\n\t}\r\n\r\n};\r\n"],"file":"priority.min.js"}