{"version":3,"sources":["priority.js"],"names":["window","GIDA","menu_priority","id","opts","NS","CLS_STATE_ACTIVE","CLS_STATE_OPENED","root","document","getElementById","getElementsByClassName","menuBar","querySelector","getElementsByTagName","lis","Array","from","querySelectorAll","autoClose","scrollTop","resizeListeners","scrollListeners","scrollableDetectionTargets","detectScrollable","elm","scrollWidth","clientWidth","r","scrollLeft","classList","remove","throttle","fn","isRunning","run","requestAnimationFrame","addEventListener","l","passive","rob","ResizeObserver","oes","oe","target","tar","observe","initializeScrollableDetection","panel","menuPanel","panelParent","createElement","add","menu","appendChild","initPanel","liBtn","btn","item","initButton","e","contains","close","setTimeout","pageYOffset","open","stopPropagation","li","ws","alignItems","remW","parentElement","getBoundingClientRect","width","sep","length","btnW","reduce","s","v","i","offsetWidth","insertBefore","style","display","map","doFirst","push","onResize","onScroll","bcr","bottom","top","Math","abs","doOnScroll"],"mappings":"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","file":"priority.min.js","sourcesContent":["/**\r\n *\r\n * Gida Menu - Priority (JS)\r\n *\r\n * @author Takuto Yanagida\r\n * @version 2021-07-05\r\n *\r\n */\r\n\r\n\r\nwindow.GIDA = window['GIDA'] ?? {};\r\n\r\n\r\nwindow.GIDA.menu_priority = function (id, opts) {\r\n\tconst NS         = 'gida-menu-priority';\r\n\tconst CLS_BAR    = NS + '-bar';\r\n\tconst CLS_PANELS = NS + '-panels';\r\n\tconst CLS_PANEL  = NS + '-panel';\r\n\tconst CLS_BUTTON = NS + '-button';\r\n\r\n\tconst CLS_STATE_READY  = 'ready';\r\n\tconst CLS_STATE_ACTIVE = 'active';\r\n\tconst CLS_STATE_OPENED = 'opened';\r\n\r\n\tconst root = id ? document.getElementById(id) : document.getElementsByClassName(NS)[0];\r\n\tif (!root) return;\r\n\r\n\tconst menuBar = root.querySelector('.menu') ?? root.getElementsByTagName('ul')[0];\r\n\tconst lis     = Array.from(menuBar.querySelectorAll('li'));\r\n\r\n\tconst autoClose = opts['autoClose'] ?? true;\r\n\r\n\tlet scrollTop = 0;\r\n\r\n\r\n\t// -------------------------------------------------------------------------\r\n\r\n\r\n\t/**\r\n\t *\r\n\t * Common Functions (JS)\r\n\t *\r\n\t * @author Takuto Yanagida\r\n\t * @version 2021-06-30\r\n\t *\r\n\t */\r\n\t\r\n\t\r\n\tconst resizeListeners = [];\r\n\tconst scrollListeners = [];\r\n\t\r\n\tfunction onResize(fn, doFirst = false) {\r\n\t\tif (doFirst) fn();\r\n\t\tresizeListeners.push(throttle(fn));\r\n\t}\r\n\t\r\n\tfunction onScroll(fn, doFirst = false) {\r\n\t\tif (doFirst) fn();\r\n\t\tscrollListeners.push(throttle(fn));\r\n\t}\r\n\t\r\n\t\r\n\t// -----------------------------------------------------------------------------\r\n\t\r\n\t\r\n\tconst scrollableDetectionTargets = [];\r\n\t\r\n\tfunction addScrollableDetectionTarget(tar) {\r\n\t\tscrollableDetectionTargets.push(tar);\r\n\t}\r\n\t\r\n\tfunction initializeScrollableDetection() {\r\n\t\tconst rob = new ResizeObserver(oes => {\r\n\t\t\tfor (const oe of oes) detectScrollable(oe.target);\r\n\t\t});\r\n\t\tfor (const tar of scrollableDetectionTargets) {\r\n\t\t\trob.observe(tar);\r\n\t\t\ttar.addEventListener('scroll', throttle(() => { detectScrollable(tar); }));\r\n\t\t}\r\n\t}\r\n\t\r\n\tfunction detectScrollable(elm) {\r\n\t\tif (elm.scrollWidth - elm.clientWidth > 2) {  // for avoiding needless scrolling\r\n\t\t\tconst r = elm.scrollLeft / (elm.scrollWidth - elm.clientWidth);\r\n\t\t\telm.classList[r < 0.95 ? 'add' : 'remove']('scrollable-right');\r\n\t\t\telm.classList[0.05 < r ? 'add' : 'remove']('scrollable-left');\r\n\t\t} else {\r\n\t\t\telm.classList.remove('scrollable-right');\r\n\t\t\telm.classList.remove('scrollable-left');\r\n\t\t}\r\n\t}\r\n\t\r\n\t\r\n\t// -----------------------------------------------------------------------------\r\n\t\r\n\t\r\n\tdocument.addEventListener('DOMContentLoaded', () => {\r\n\t\twindow.addEventListener('resize', () => { for (const l of resizeListeners) l(); }, { passive: true });\r\n\t\twindow.addEventListener('scroll', () => { for (const l of scrollListeners) l(); }, { passive: true });\r\n\t\tinitializeScrollableDetection();\r\n\t});\r\n\t\r\n\tfunction throttle(fn) {\r\n\t\tlet isRunning;\r\n\t\tfunction run() {\r\n\t\t\tisRunning = false;\r\n\t\t\tfn();\r\n\t\t}\r\n\t\treturn () => {\r\n\t\t\tif (isRunning) return;\r\n\t\t\tisRunning = true;\r\n\t\t\trequestAnimationFrame(run);\r\n\t\t};\r\n\t}\r\n\t\r\n\r\n\r\n\t// -------------------------------------------------------------------------\r\n\r\n\r\n\tconst [panel, menuPanel] = initPanel(root);\r\n\tconst [liBtn, btn]       = initButton(menuBar);\r\n\r\n\tmenuBar.appendChild(liBtn);\r\n\r\n\tbtn.addEventListener('click', (e) => {\r\n\t\tif (liBtn.classList.contains(CLS_STATE_OPENED)) {\r\n\t\t\tclose(liBtn, panel);\r\n\t\t} else {\r\n\t\t\topen(liBtn, panel);\r\n\t\t}\r\n\t\te.stopPropagation();\r\n\t});\r\n\tfor (const li of lis) {\r\n\t\tli.addEventListener('click', () => { close(liBtn, panel); });\r\n\t}\r\n\r\n\tlet ws = [];\r\n\tsetTimeout(() => {\r\n\t\tws = lis.map((e) => e.offsetWidth);\r\n\t\talignItems(ws, menuBar, menuPanel, lis, liBtn);\r\n\t\tonResize(() => { alignItems(ws, menuBar, menuPanel, lis, liBtn); });\r\n\t}, 10);\r\n\tsetTimeout(() => { root.classList.add(CLS_STATE_READY); }, 100);\r\n\r\n\tif (autoClose) {\r\n\t\tonScroll(() => { doOnScroll(liBtn, panel); });\r\n\t\tdocument.addEventListener('click', () => { close(liBtn, panel); });\r\n\t}\r\n\r\n\r\n\t// -------------------------------------------------------------------------\r\n\r\n\r\n\tfunction initPanel(root) {\r\n\t\tconst panelParent = document.createElement('div');\r\n\t\tpanelParent.classList.add(CLS_PANELS);\r\n\r\n\t\tconst panel = document.createElement('div');\r\n\t\tpanel.classList.add(CLS_PANEL);\r\n\r\n\t\tconst menu = document.createElement('ul');\r\n\t\tmenu.classList.add('menu');\r\n\r\n\t\tpanel.appendChild(menu);\r\n\t\tpanelParent.appendChild(panel);\r\n\t\troot.appendChild(panelParent);\r\n\t\treturn [panel, menu];\r\n\t}\r\n\r\n\tfunction initButton(menuBar) {\r\n\t\tconst btn = document.createElement('button');\r\n\t\tbtn.classList.add(CLS_BUTTON);\r\n\t\tconst item = document.createElement('li');\r\n\t\titem.appendChild(btn);\r\n\t\tmenuBar.appendChild(item);\r\n\t\treturn [item, btn];\r\n\t}\r\n\r\n\r\n\t// -------------------------------------------------------------------------\r\n\r\n\r\n\tfunction close(liBtn, panel) {\r\n\t\tliBtn.classList.remove(CLS_STATE_OPENED);\r\n\t\tpanel.classList.remove(CLS_STATE_ACTIVE);\r\n\t\tsetTimeout(() => {\r\n\t\t\tpanel.classList.remove(CLS_STATE_OPENED);\r\n\t\t}, 400);\r\n\t}\r\n\r\n\tfunction open(liBtn, panel) {\r\n\t\tliBtn.classList.add(CLS_STATE_OPENED);\r\n\t\tpanel.classList.add(CLS_STATE_ACTIVE);\r\n\t\tsetTimeout(() => {\r\n\t\t\tpanel.classList.add(CLS_STATE_OPENED);\r\n\t\t}, 0);\r\n\t\tscrollTop = window.pageYOffset;\r\n\t}\r\n\r\n\tfunction doOnScroll(liBtn, panel) {\r\n\t\tconst bcr = panel.getBoundingClientRect();\r\n\t\tif (\r\n\t\t\tbcr.bottom < 0 ||  // When not fixed\r\n\t\t\t(0 < bcr.top && bcr.bottom < Math.abs(window.pageYOffset - scrollTop))  // When fixed\r\n\t\t) {\r\n\t\t\tclose(liBtn, panel);\r\n\t\t}\r\n\t}\r\n\r\n\tfunction alignItems(ws, menuBar, menuPanel, lis, liBtn) {\r\n\t\tlet remW = menuBar.parentElement.getBoundingClientRect().width;\r\n\t\tlet sep  = lis.length;\r\n\r\n\t\tconst btnW = liBtn.clientWidth;\r\n\t\tconst sum  = ws.reduce((s, v) => s + v);\r\n\r\n\t\tif (remW < sum) {\r\n\t\t\tremW -= btnW;\r\n\t\t\tfor (let i = 0; i < ws.length; i += 1) {\r\n\t\t\t\tif ((remW -= ws[i]) < 0) {\r\n\t\t\t\t\tsep = i;\r\n\t\t\t\t\tbreak;\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\t\tfor (let i = 0; i < sep; i += 1) {\r\n\t\t\tif (lis[i].parentElement === menuBar) {\r\n\t\t\t\tws[i] = lis[i].offsetWidth;\r\n\t\t\t} else {\r\n\t\t\t\tmenuBar.insertBefore(lis[i], liBtn);\r\n\t\t\t}\r\n\t\t}\r\n\t\tfor (let i = sep; i < lis.length; i += 1) menuPanel.appendChild(lis[i]);\r\n\t\tliBtn.style.display = (sep === lis.length) ? 'none' : '';\r\n\t}\r\n\r\n};\r\n"]}