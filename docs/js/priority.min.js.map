{"version":3,"sources":["priority.js"],"names":["window","menu_priority","id","arguments","length","undefined","opts","NS","CLS_PANELS","CLS_PANEL","CLS_BUTTON","CLS_CURRENT","CLS_READY","CLS_HOVER","CLS_ACTIVE","CLS_OPENED","root","document","getElementById","getElementsByClassName","menuBar","querySelector","getElementsByTagName","lis","Array","from","querySelectorAll","menuBarStyle","getComputedStyle","autoClose","scrollTop","columnGap","resizeListeners","scrollListeners","onResize","fn","doFirst","push","throttle","onScroll","scrollableDetectionTargets","initializeScrollableDetection","rob","ResizeObserver","oes","oe","detectScrollable","target","tar","observe","addEventListener","elm","scrollWidth","clientWidth","r","scrollLeft","classList","remove","addHoverStateEventListener","items","clsCurrent","clsHover","clsHoverAncestor","enter","e","pointerType","contains","add","parentElement","leave","it","isRunning","run","requestAnimationFrame","l","passive","panel","menuPanel","initPanel","liBtn","btn","initButton","appendChild","close","open","stopPropagation","li","ws","panelParent","createElement","menu","item","setTimeout","pageYOffset","doOnScroll","bcr","getBoundingClientRect","bottom","top","Math","abs","alignItems","remW","width","sep","btnW","reduce","s","v","i","offsetWidth","insertBefore","parseInt","Number","isNaN","style","display","map"],"mappings":"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","file":"priority.min.js","sourcesContent":["/**\n * Gida Menu - Priority\n *\n * @author Takuto Yanagida\n * @version 2022-06-04\n */\n\n\nwindow['GIDA'] = window['GIDA'] ?? {};\n\n\nwindow['GIDA'].menu_priority = function (id = null, opts = {}) {\n\tconst NS         = 'gida-menu-priority';\n\tconst CLS_PANELS = NS + '-panels';\n\tconst CLS_PANEL  = NS + '-panel';\n\tconst CLS_BUTTON = NS + '-button';\n\n\tconst CLS_CURRENT = 'current';\n\n\tconst CLS_READY  = 'ready';\n\tconst CLS_HOVER  = 'hover';\n\tconst CLS_ACTIVE = 'active';\n\tconst CLS_OPENED = 'opened';\n\n\tconst root = id ? document.getElementById(id) : document.getElementsByClassName(NS)[0];\n\tif (!root) return;\n\tconst menuBar = root.querySelector('.menu') ?? root.getElementsByTagName('ul')[0];\n\tif (!menuBar) return;\n\tconst lis = Array.from(menuBar.querySelectorAll('li'));\n\n\tconst menuBarStyle = getComputedStyle(menuBar);\n\tconst autoClose    = opts['autoClose'] ?? true;\n\n\tlet scrollTop = 0;\n\tlet columnGap = 0;\n\n\n\t// -------------------------------------------------------------------------\n\n\n\t/**\n\t * Common Functions\n\t *\n\t * @author Takuto Yanagida\n\t * @version 2022-06-01\n\t */\n\t\n\t\n\tconst resizeListeners = [];\n\tconst scrollListeners = [];\n\t\n\tfunction onResize(fn, doFirst = false) {\n\t\tif (doFirst) fn();\n\t\tresizeListeners.push(throttle(fn));\n\t}\n\t\n\tfunction onScroll(fn, doFirst = false) {\n\t\tif (doFirst) fn();\n\t\tscrollListeners.push(throttle(fn));\n\t}\n\t\n\t\n\t// -----------------------------------------------------------------------------\n\t\n\t\n\tconst scrollableDetectionTargets = [];\n\t\n\tfunction addScrollableDetectionTarget(tar) {\n\t\tscrollableDetectionTargets.push(tar);\n\t}\n\t\n\tfunction initializeScrollableDetection() {\n\t\tconst rob = new ResizeObserver(oes => {\n\t\t\tfor (const oe of oes) detectScrollable(oe.target);\n\t\t});\n\t\tfor (const tar of scrollableDetectionTargets) {\n\t\t\trob.observe(tar);\n\t\t\ttar.addEventListener('scroll', throttle(() => { detectScrollable(tar); }));\n\t\t}\n\t}\n\t\n\tfunction detectScrollable(elm) {\n\t\tif (elm.scrollWidth - elm.clientWidth > 2) {  // for avoiding needless scrolling\n\t\t\tconst r = elm.scrollLeft / (elm.scrollWidth - elm.clientWidth);\n\t\t\telm.classList[r < 0.95 ? 'add' : 'remove']('scrollable-right');\n\t\t\telm.classList[0.05 < r ? 'add' : 'remove']('scrollable-left');\n\t\t} else {\n\t\t\telm.classList.remove('scrollable-right');\n\t\t\telm.classList.remove('scrollable-left');\n\t\t}\n\t}\n\t\n\t\n\t// -----------------------------------------------------------------------------\n\t\n\t\n\tfunction addHoverStateEventListener(items, clsCurrent, clsHover, root = null, clsHoverAncestor = null) {\n\t\tconst enter = (e) => {\n\t\t\tif (e.pointerType === 'mouse' && !e.target.classList.contains(clsCurrent)) {\n\t\t\t\te.target.classList.add(clsHover);\n\t\t\t\tif (clsHoverAncestor) {\n\t\t\t\t\tfor (let elm = e.target.parentElement; elm && elm !== root; elm = elm.parentElement) {\n\t\t\t\t\t\tif (elm.classList.contains(clsHover)) {\n\t\t\t\t\t\t\telm.classList.add(clsHoverAncestor);\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t\tconst leave = (e) => {\n\t\t\tif (e.pointerType === 'mouse' && !e.target.classList.contains(clsCurrent)) {\n\t\t\t\te.target.classList.remove(clsHover);\n\t\t\t\tif (clsHoverAncestor) {\n\t\t\t\t\tfor (let elm = e.target.parentElement; elm && elm !== root; elm = elm.parentElement) {\n\t\t\t\t\t\tif (elm.classList.contains(clsHover)) {\n\t\t\t\t\t\t\telm.classList.remove(clsHoverAncestor);\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t\tfor (const it of items) {\n\t\t\tit.addEventListener('pointerenter', enter);\n\t\t\tit.addEventListener('pointerleave', leave);\n\t\t}\n\t}\n\t\n\t\n\t// -----------------------------------------------------------------------------\n\t\n\t\n\tdocument.addEventListener('DOMContentLoaded', () => {\n\t\twindow.addEventListener('resize', () => { for (const l of resizeListeners) l(); }, { passive: true });\n\t\twindow.addEventListener('scroll', () => { for (const l of scrollListeners) l(); }, { passive: true });\n\t\tinitializeScrollableDetection();\n\t});\n\t\n\tfunction throttle(fn) {\n\t\tlet isRunning;\n\t\tfunction run() {\n\t\t\tisRunning = false;\n\t\t\tfn();\n\t\t}\n\t\treturn () => {\n\t\t\tif (isRunning) return;\n\t\t\tisRunning = true;\n\t\t\trequestAnimationFrame(run);\n\t\t};\n\t}\n\t\n\n\n\t// -------------------------------------------------------------------------\n\n\n\tconst [panel, menuPanel] = initPanel(root);\n\tconst [liBtn, btn]       = initButton(menuBar);\n\n\tmenuBar.appendChild(liBtn);\n\n\tbtn.addEventListener('click', (e) => {\n\t\tif (liBtn.classList.contains(CLS_OPENED)) {\n\t\t\tclose(liBtn, panel);\n\t\t} else {\n\t\t\topen(liBtn, panel);\n\t\t}\n\t\te.stopPropagation();\n\t});\n\tfor (const li of lis) {\n\t\tli.addEventListener('click', () => { close(liBtn, panel); });\n\t}\n\taddHoverStateEventListener(lis, CLS_CURRENT, CLS_HOVER);\n\n\tlet ws = [];\n\tsetTimeout(() => {\n\t\tws        = lis.map((e) => e.offsetWidth);\n\t\tcolumnGap = parseInt(menuBarStyle.columnGap, 10);\n\t\tcolumnGap = Number.isNaN(columnGap) ? 0 : columnGap;\n\t\talignItems(ws, menuBar, menuPanel, lis, liBtn);\n\t\tonResize(() => { alignItems(ws, menuBar, menuPanel, lis, liBtn); });\n\t}, 10);\n\tsetTimeout(() => { root.classList.add(CLS_READY); }, 100);\n\n\tif (autoClose) {\n\t\tonScroll(() => { doOnScroll(liBtn, panel); });\n\t\tdocument.addEventListener('click', () => { close(liBtn, panel); });\n\t}\n\n\n\t// -------------------------------------------------------------------------\n\n\n\tfunction initPanel(root) {\n\t\tconst panelParent = document.createElement('div');\n\t\tpanelParent.classList.add(CLS_PANELS);\n\n\t\tconst panel = document.createElement('div');\n\t\tpanel.classList.add(CLS_PANEL);\n\n\t\tconst menu = document.createElement('ul');\n\t\tmenu.classList.add('menu');\n\n\t\tpanel.appendChild(menu);\n\t\tpanelParent.appendChild(panel);\n\t\troot.appendChild(panelParent);\n\t\treturn [panel, menu];\n\t}\n\n\tfunction initButton(menuBar) {\n\t\tconst btn = document.createElement('button');\n\t\tbtn.classList.add(CLS_BUTTON);\n\t\tconst item = document.createElement('li');\n\t\titem.appendChild(btn);\n\t\tmenuBar.appendChild(item);\n\t\treturn [item, btn];\n\t}\n\n\n\t// -------------------------------------------------------------------------\n\n\n\tfunction close(liBtn, panel) {\n\t\tliBtn.classList.remove(CLS_OPENED);\n\t\tpanel.classList.remove(CLS_ACTIVE);\n\t\tsetTimeout(() => {\n\t\t\tpanel.classList.remove(CLS_OPENED);\n\t\t}, 400);\n\t}\n\n\tfunction open(liBtn, panel) {\n\t\tliBtn.classList.add(CLS_OPENED);\n\t\tpanel.classList.add(CLS_ACTIVE);\n\t\tsetTimeout(() => {\n\t\t\tpanel.classList.add(CLS_OPENED);\n\t\t}, 0);\n\t\tscrollTop = window.pageYOffset;\n\t}\n\n\tfunction doOnScroll(liBtn, panel) {\n\t\tconst bcr = panel.getBoundingClientRect();\n\t\tif (\n\t\t\tbcr.bottom < 0 ||  // When not fixed\n\t\t\t(0 < bcr.top && bcr.bottom < Math.abs(window.pageYOffset - scrollTop))  // When fixed\n\t\t) {\n\t\t\tclose(liBtn, panel);\n\t\t}\n\t}\n\n\tfunction alignItems(ws, menuBar, menuPanel, lis, liBtn) {\n\t\tlet remW = menuBar.parentElement.getBoundingClientRect().width;\n\t\tlet sep  = lis.length;\n\n\t\tconst btnW = liBtn.clientWidth;\n\t\tconst sum  = ws.reduce((s, v) => s + v) + (columnGap * (ws.length - 1));\n\n\t\tif (remW < sum) {\n\t\t\tremW -= btnW;\n\t\t\tfor (let i = 0; i < ws.length; i += 1) {\n\t\t\t\tif ((remW -= ws[i] + columnGap) < 0) {\n\t\t\t\t\tsep = i;\n\t\t\t\t\tbreak;\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t\tfor (let i = 0; i < sep; i += 1) {\n\t\t\tif (lis[i].parentElement === menuBar) {\n\t\t\t\tws[i] = lis[i].offsetWidth;\n\t\t\t} else {\n\t\t\t\tmenuBar.insertBefore(lis[i], liBtn);\n\t\t\t}\n\t\t}\n\t\tcolumnGap = parseInt(menuBarStyle.columnGap, 10);\n\t\tcolumnGap = Number.isNaN(columnGap) ? 0 : columnGap;\n\t\tfor (let i = sep; i < lis.length; i += 1) menuPanel.appendChild(lis[i]);\n\t\tliBtn.style.display = (sep === lis.length) ? 'none' : '';\n\t}\n\n};\n"]}