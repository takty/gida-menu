{"version":3,"sources":["priority.js"],"names":["window","menu_priority","id","arguments","length","undefined","opts","NS","CLS_PANELS","CLS_PANEL","CLS_BUTTON","CLS_CURRENT","CLS_READY","CLS_HOVER","CLS_ACTIVE","CLS_OPENED","CP_MAX_WIDTH","CP_FOLDABLE","root","document","getElementById","getElementsByClassName","menuBar","querySelector","getElementsByTagName","lis","Array","from","querySelectorAll","menuBarStyle","getComputedStyle","autoClose","reversed","btnPos","order","initOrder","scrollTop","columnGap","resizeListeners","scrollListeners","onResize","fn","doFirst","push","throttle","onScroll","scrollableDetectionTargets","initializeScrollableDetection","rob","ResizeObserver","oes","oe","detectScrollable","target","tar","observe","addEventListener","elm","scrollWidth","clientWidth","r","scrollLeft","classList","remove","addHoverStateEventListener","items","clsCurrent","clsHover","clsHoverAncestor","enter","e","pointerType","contains","add","parentElement","leave","it","isRunning","run","requestAnimationFrame","l","passive","panel","menuPanel","initPanel","liBtn","btn","initButton","append","prepend","close","open","stopPropagation","li","ws","i","getWeightFromClass","sort","a","b","reverse","def","cs","className","split","w","c","n","parseInt","isNaN","panelParent","createElement","menu","appendChild","item","setTimeout","pageYOffset","doOnScroll","bcr","getBoundingClientRect","bottom","top","Math","abs","setMaxWidth","p","parseFloat","paddingLeft","paddingRight","style","setProperty","alignItems","width","barW","inBar","withPanel","calcItemPlace","display","getPropertyValue","trim","fill","offsetWidth","insertBefore","Number","sumW","reduce","s","v","toPanel","map"],"mappings":"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","file":"priority.min.js","sourcesContent":["/**\n * Gida Menu - Priority\n *\n * @author Takuto Yanagida\n * @version 2022-10-04\n */\n\nwindow['GIDA'] = window['GIDA'] ?? {};\n\nwindow['GIDA'].menu_priority = function (id = null, opts = {}) {\n\tconst NS         = 'gida-menu-priority';\n\tconst CLS_PANELS = NS + '-panels';\n\tconst CLS_PANEL  = NS + '-panel';\n\tconst CLS_BUTTON = NS + '-button';\n\n\tconst CLS_CURRENT = 'current';\n\n\tconst CLS_READY  = 'ready';\n\tconst CLS_HOVER  = 'hover';\n\tconst CLS_ACTIVE = 'active';\n\tconst CLS_OPENED = 'opened';\n\n\tconst CP_MAX_WIDTH = '--max-width';\n\tconst CP_FOLDABLE  = '--foldable';\n\n\tconst root = id ? document.getElementById(id) : document.getElementsByClassName(NS)[0];\n\tif (!root) return;\n\tconst menuBar = root.querySelector('.menu') ?? root.getElementsByTagName('ul')[0];\n\tif (!menuBar) return;\n\tconst lis = Array.from(menuBar.querySelectorAll(':scope > li'));\n\n\tconst menuBarStyle = getComputedStyle(menuBar);\n\tconst autoClose    = opts['autoClose']      ?? true;\n\tconst reversed     = opts['reversed']       ?? false;\n\tconst btnPos       = opts['buttonPosition'] ?? 'end';  // 'start' or 'end';\n\n\tconst order = initOrder(lis, reversed);\n\n\tlet scrollTop = 0;\n\tlet columnGap = 0;\n\n\n\t// -------------------------------------------------------------------------\n\n\n\t/**\n\t * Common Functions\n\t *\n\t * @author Takuto Yanagida\n\t * @version 2022-06-01\n\t */\n\t\n\t\n\tconst resizeListeners = [];\n\tconst scrollListeners = [];\n\t\n\tfunction onResize(fn, doFirst = false) {\n\t\tif (doFirst) fn();\n\t\tresizeListeners.push(throttle(fn));\n\t}\n\t\n\tfunction onScroll(fn, doFirst = false) {\n\t\tif (doFirst) fn();\n\t\tscrollListeners.push(throttle(fn));\n\t}\n\t\n\t\n\t// -----------------------------------------------------------------------------\n\t\n\t\n\tconst scrollableDetectionTargets = [];\n\t\n\tfunction addScrollableDetectionTarget(tar) {\n\t\tscrollableDetectionTargets.push(tar);\n\t}\n\t\n\tfunction initializeScrollableDetection() {\n\t\tconst rob = new ResizeObserver(oes => {\n\t\t\tfor (const oe of oes) detectScrollable(oe.target);\n\t\t});\n\t\tfor (const tar of scrollableDetectionTargets) {\n\t\t\trob.observe(tar);\n\t\t\ttar.addEventListener('scroll', throttle(() => { detectScrollable(tar); }));\n\t\t}\n\t}\n\t\n\tfunction detectScrollable(elm) {\n\t\tif (elm.scrollWidth - elm.clientWidth > 2) {  // for avoiding needless scrolling\n\t\t\tconst r = elm.scrollLeft / (elm.scrollWidth - elm.clientWidth);\n\t\t\telm.classList[r < 0.95 ? 'add' : 'remove']('scrollable-right');\n\t\t\telm.classList[0.05 < r ? 'add' : 'remove']('scrollable-left');\n\t\t} else {\n\t\t\telm.classList.remove('scrollable-right');\n\t\t\telm.classList.remove('scrollable-left');\n\t\t}\n\t}\n\t\n\t\n\t// -----------------------------------------------------------------------------\n\t\n\t\n\tfunction addHoverStateEventListener(items, clsCurrent, clsHover, root = null, clsHoverAncestor = null) {\n\t\tconst enter = (e) => {\n\t\t\tif (e.pointerType === 'mouse' && !e.target.classList.contains(clsCurrent)) {\n\t\t\t\te.target.classList.add(clsHover);\n\t\t\t\tif (clsHoverAncestor) {\n\t\t\t\t\tfor (let elm = e.target.parentElement; elm && elm !== root; elm = elm.parentElement) {\n\t\t\t\t\t\tif (elm.classList.contains(clsHover)) {\n\t\t\t\t\t\t\telm.classList.add(clsHoverAncestor);\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t\tconst leave = (e) => {\n\t\t\tif (e.pointerType === 'mouse' && !e.target.classList.contains(clsCurrent)) {\n\t\t\t\te.target.classList.remove(clsHover);\n\t\t\t\tif (clsHoverAncestor) {\n\t\t\t\t\tfor (let elm = e.target.parentElement; elm && elm !== root; elm = elm.parentElement) {\n\t\t\t\t\t\tif (elm.classList.contains(clsHover)) {\n\t\t\t\t\t\t\telm.classList.remove(clsHoverAncestor);\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t\tfor (const it of items) {\n\t\t\tit.addEventListener('pointerenter', enter);\n\t\t\tit.addEventListener('pointerleave', leave);\n\t\t}\n\t}\n\t\n\t\n\t// -----------------------------------------------------------------------------\n\t\n\t\n\tdocument.addEventListener('DOMContentLoaded', () => {\n\t\twindow.addEventListener('resize', () => { for (const l of resizeListeners) l(); }, { passive: true });\n\t\twindow.addEventListener('scroll', () => { for (const l of scrollListeners) l(); }, { passive: true });\n\t\tinitializeScrollableDetection();\n\t});\n\t\n\tfunction throttle(fn) {\n\t\tlet isRunning;\n\t\tfunction run() {\n\t\t\tisRunning = false;\n\t\t\tfn();\n\t\t}\n\t\treturn () => {\n\t\t\tif (isRunning) return;\n\t\t\tisRunning = true;\n\t\t\trequestAnimationFrame(run);\n\t\t};\n\t}\n\t\n\n\n\t// -------------------------------------------------------------------------\n\n\n\tconst [panel, menuPanel] = initPanel(root);\n\tconst [liBtn, btn]       = initButton(menuBar);\n\n\tif ('end' === btnPos) {\n\t\tmenuBar.append(liBtn);\n\t} else if ('start' === btnPos) {\n\t\tmenuBar.prepend(liBtn);\n\t}\n\n\tbtn.addEventListener('click', (e) => {\n\t\tif (liBtn.classList.contains(CLS_OPENED)) {\n\t\t\tclose(liBtn, panel);\n\t\t} else {\n\t\t\topen(liBtn, panel);\n\t\t}\n\t\te.stopPropagation();\n\t});\n\tfor (const li of lis) {\n\t\tli.addEventListener('click', () => { close(liBtn, panel); });\n\t}\n\taddHoverStateEventListener(lis, CLS_CURRENT, CLS_HOVER);\n\n\tlet ws = [];\n\tsetTimeout(() => {\n\t\tws        = lis.map((e) => e.offsetWidth);\n\t\tcolumnGap = parseInt(menuBarStyle.columnGap, 10);\n\t\tcolumnGap = Number.isNaN(columnGap) ? 0 : columnGap;\n\t\talignItems(ws, menuBar, menuPanel, lis, liBtn);\n\t\tonResize(() => {\n\t\t\tclose(liBtn, panel);\n\t\t\tsetMaxWidth(root);\n\t\t\talignItems(ws, menuBar, menuPanel, lis, liBtn);\n\t\t});\n\t}, 10);\n\tsetTimeout(() => { root.classList.add(CLS_READY); }, 100);\n\n\tif (autoClose) {\n\t\tonScroll(() => { doOnScroll(liBtn, panel); });\n\t\tdocument.addEventListener('click', () => { close(liBtn, panel); });\n\t}\n\n\n\t// -------------------------------------------------------------------------\n\n\n\tfunction initOrder(lis, reversed) {\n\t\tconst ws = new Array(lis.length);\n\t\tfor (let i = 0; i < lis.length; i += 1) {\n\t\t\tws[i] = getWeightFromClass(lis[i], lis.length - i);\n\t\t}\n\t\tconst order = new Array(lis.length);\n\t\tfor (let i = 0; i < lis.length; i += 1) order[i] = i;\n\t\torder.sort((a, b) => ws[a] < ws[b] ? 1 : ws[a] > ws[b] ? -1 : 0);\n\n\t\tif (reversed) {\n\t\t\torder.reverse();\n\t\t}\n\t\treturn order;\n\t}\n\n\tfunction getWeightFromClass(li, def) {\n\t\tconst cs = li.className.split(' ');\n\t\tlet w = null;\n\t\tfor (const c of cs) {\n\t\t\tconst n = parseInt(c, 10);\n\t\t\tif (isNaN(n)) continue;\n\t\t\tif (null === w || w < n) w = n;\n\t\t}\n\t\treturn w ?? def;\n\t}\n\n\tfunction initPanel(root) {\n\t\tconst panelParent = document.createElement('div');\n\t\tpanelParent.classList.add(CLS_PANELS);\n\n\t\tconst panel = document.createElement('div');\n\t\tpanel.classList.add(CLS_PANEL);\n\t\tif ('end' === btnPos || 'start' === btnPos) {\n\t\t\tpanel.classList.add('end' === btnPos ? 'end' : 'start');\n\t\t}\n\n\t\tconst menu = document.createElement('ul');\n\t\tmenu.classList.add('menu');\n\n\t\tpanel.appendChild(menu);\n\t\tpanelParent.appendChild(panel);\n\t\troot.appendChild(panelParent);\n\t\treturn [panel, menu];\n\t}\n\n\tfunction initButton(menuBar) {\n\t\tconst btn = document.createElement('button');\n\t\tbtn.classList.add(CLS_BUTTON);\n\t\tconst item = document.createElement('li');\n\t\titem.appendChild(btn);\n\t\tmenuBar.appendChild(item);\n\t\treturn [item, btn];\n\t}\n\n\n\t// -------------------------------------------------------------------------\n\n\n\tfunction close(liBtn, panel) {\n\t\tliBtn.classList.remove(CLS_OPENED);\n\t\tpanel.classList.remove(CLS_ACTIVE);\n\t\tsetTimeout(() => {\n\t\t\tpanel.classList.remove(CLS_OPENED);\n\t\t}, 400);\n\t}\n\n\tfunction open(liBtn, panel) {\n\t\tliBtn.classList.add(CLS_OPENED);\n\t\tpanel.classList.add(CLS_ACTIVE);\n\t\tsetTimeout(() => {\n\t\t\tpanel.classList.add(CLS_OPENED);\n\t\t}, 0);\n\t\tscrollTop = window.pageYOffset;\n\t}\n\n\tfunction doOnScroll(liBtn, panel) {\n\t\tconst bcr = panel.getBoundingClientRect();\n\t\tif (\n\t\t\tbcr.bottom < 0 ||  // When not fixed\n\t\t\t(0 < bcr.top && bcr.bottom < Math.abs(window.pageYOffset - scrollTop))  // When fixed\n\t\t) {\n\t\t\tclose(liBtn, panel);\n\t\t}\n\t}\n\n\tfunction setMaxWidth(root) {\n\t\tconst p  = root.parentElement;\n\t\tconst cs = getComputedStyle(p);\n\t\tconst w  = p.clientWidth - (parseFloat(cs.paddingLeft) + parseFloat(cs.paddingRight));\n\n\t\troot.style.setProperty(CP_MAX_WIDTH, `${w}px`);\n\t}\n\n\tfunction alignItems(ws, menuBar, menuPanel, lis, liBtn) {\n\t\tmenuBar.style.width = '0';\n\t\tlet barW = menuBar.parentElement.getBoundingClientRect().width;\n\t\tmenuBar.style.width = null;\n\n\t\tconst [inBar, withPanel] = calcItemPlace(barW, ws, lis, liBtn, columnGap);\n\t\tliBtn.style.display = withPanel ? null : 'none';\n\n\t\tif ('false' === getComputedStyle(menuBar).getPropertyValue(CP_FOLDABLE).trim()) {\n\t\t\tinBar.fill(true);\n\t\t\tliBtn.style.display = 'none';\n\t\t}\n\n\t\tfor (let i = 0; i < lis.length; i += 1) {\n\t\t\tif (!inBar[i]) continue;\n\t\t\tif (lis[i].parentElement === menuBar) {\n\t\t\t\tws[i] = lis[i].offsetWidth;\n\t\t\t}\n\t\t\tif ('end' === btnPos) {\n\t\t\t\tmenuBar.insertBefore(lis[i], liBtn);\n\t\t\t} else if ('start' === btnPos) {\n\t\t\t\tmenuBar.appendChild(lis[i], liBtn);\n\t\t\t}\n\t\t}\n\n\t\tcolumnGap = parseInt(menuBarStyle.columnGap, 10);\n\t\tcolumnGap = Number.isNaN(columnGap) ? 0 : columnGap;\n\n\t\tfor (let i = 0; i < lis.length; i += 1) {\n\t\t\tif (!inBar[i]) menuPanel.appendChild(lis[i]);\n\t\t}\n\t}\n\n\tfunction calcItemPlace(barW, ws, lis, liBtn, columnGap) {\n\t\tconst inBar = new Array(lis.length);\n\t\tinBar.fill(true);\n\n\t\tconst sumW = ws.reduce((s, v) => s + v) + (columnGap * (ws.length - 1));\n\n\t\tif (barW < sumW) {\n\t\t\tbarW -= liBtn.clientWidth;\n\n\t\t\tlet toPanel = lis.length;\n\t\t\tfor (let i = 0; i < lis.length; i += 1) {\n\t\t\t\tif ((barW -= ws[order[i]] + columnGap) < 0) {\n\t\t\t\t\ttoPanel = i;\n\t\t\t\t\tbreak;\n\t\t\t\t}\n\t\t\t}\n\t\t\tfor (let i = toPanel; i < lis.length; i += 1) {\n\t\t\t\tinBar[order[i]] = false;\n\t\t\t}\n\t\t}\n\t\treturn [inBar, barW < sumW];\n\t}\n\n};\n"]}